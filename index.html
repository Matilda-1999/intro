<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>1890ë…„, ë‹¹ì‹ ì˜ íŒŒë¦¬</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@400;700&display=swap");
      :root {
        --bg: #0a0a0a;
        --txt: #d1d1d1;
        --accent: #a5d6a7;
        --dim: #777;
        --border: #333;
      }
      body {
        background: var(--bg);
        color: var(--txt);
        font-family: "Nanum+Myeongjo", serif;
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        overflow: hidden;
      }
      #game-wrapper {
        width: 95%;
        max-width: 1100px;
        display: grid;
        grid-template-columns: 1fr 320px;
        gap: 20px;
        height: 90vh;
      }
      #main-window {
        background: #121212;
        border: 1px solid var(--border);
        padding: 50px;
        display: flex;
        flex-direction: column;
        position: relative;
        overflow-y: auto;
      }
      
      /* ğŸŒŸ ì±•í„° ì œëª©ê³¼ ë¶€ì œë¥¼ ë‹´ëŠ” í—¤ë” ì»¨í…Œì´ë„ˆ */
      #header-container {
        margin-bottom: 25px;
        border-bottom: 1px solid var(--border);
        padding-bottom: 15px;
      }
      #chapter-header {
        font-size: 0.85em;
        color: var(--accent);
        letter-spacing: 3px;
        text-transform: uppercase;
        margin-bottom: 12px;
      }
      /* ğŸŒŸ ê³ ì •ëœ ë¶€ì œ ìŠ¤íƒ€ì¼ */
      #chapter-subtitle {
        color: var(--accent);
        font-weight: bold;
        font-size: 0.95em;
        line-height: 1.5;
        word-break: keep-all;
        opacity: 0.9;
        display: none;
      }

      #text-display {
        font-size: 1.15em;
        line-height: 1.9;
        flex-grow: 1;
        white-space: pre-wrap;
        margin-bottom: 30px;
        user-select: text;
      }
      #log-window {
        background: #050505;
        border: 1px solid var(--border);
        padding: 20px;
        font-size: 0.85em;
        color: #666;
        overflow-y: auto;
        user-select: text;
      }
      .choice-btn {
        background: none;
        border: 1px solid #444;
        color: #aaa;
        padding: 18px 20px;
        margin-bottom: 12px;
        text-align: left;
        width: 100%;
        font-family: inherit;
        font-size: 1em;
        cursor: pointer;
        transition: 0.3s;
        display: block;
        user-select: text !important;
      }
      .choice-btn:hover {
        background: #1a1a1a;
        color: #fff;
        border-color: var(--accent);
      }
      .next-btn {
        background: #222;
        text-align: center;
        font-weight: bold;
        border-color: #555;
      }
      .back-btn {
        background: none;
        border: 1px dotted #555;
        color: #666;
        padding: 8px;
        font-size: 0.85em;
        cursor: pointer;
        width: 100px;
        transition: 0.3s;
      }
      .back-btn:hover {
        color: #888;
        border-color: #888;
      }
      .player-input-field {
        width: 100%;
        box-sizing: border-box;
        padding: 15px;
        margin-bottom: 15px;
        background: #1a1a1a;
        border: 1px solid #444;
        color: #fff;
        font-family: inherit;
        font-size: 1.05em;
        outline: none;
        transition: 0.3s;
      }
      .player-input-field:focus {
        border-color: var(--accent);
      }
      .thought-pause {
        color: var(--dim);
        font-style: italic;
        margin: 15px 0;
        display: block;
      }
      .fade-in {
        animation: fadeIn 0.8s forwards;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(5px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      ::-webkit-scrollbar {
        width: 4px;
      }
      ::-webkit-scrollbar-thumb {
        background: #444;
      }
    </style>

    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  </head>
  <body>
    <div id="game-wrapper">
      <div id="main-window" class="fade-in">
        <div id="header-container">
          <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div id="chapter-header">ë°ì´í„° ì´ˆê¸°í™” ì¤‘...</div>
            <button
              id="back-button"
              class="back-btn"
              onclick="goBack()"
              style="display: none"
            >
              [ë’¤ë¡œ ê°€ê¸°]
            </button>
          </div>
          <div id="chapter-subtitle"></div>
        </div>
        <div id="text-display"></div>
        <div id="choice-container"></div>
      </div>
      <div id="log-window">
        <div
          style="color: var(--accent); font-weight: bold; margin-bottom: 15px"
        >
          [ìƒê° ë³´ê´€í•¨ ë¡œê·¸]
        </div>
        <div id="log-content"></div>
      </div>
    </div>

    <script>
      let historyStack = [];
      let stats = {
        pav: 0,
        rec: 0,
        rad: 0,
        mod: 0,
        logHistory: [],
        mirrorHistory: [],
      };
      let currentIdx = 0;
      let textIdx = 0;
      let resTextIdx = 0;
      let currentResArray = [];
      let isShowingResult = false;
      let finalEncStep = 0;

      // ğŸŒŸ ë³¸ë¬¸(lines)ì—ì„œ ë¶€ì œë¥¼ ë¶„ë¦¬í•˜ì—¬ subtitle ì†ì„±ìœ¼ë¡œ ëºìŠµë‹ˆë‹¤.
      const scenario = [
        {
          title: "ì œ1 ë§‰: ì¹¨ë¬µí•˜ëŠ” ë„ì‹œì—ì„œ",
          subtitle: "â€” ì´ ë„ì‹œëŠ” ë²½ë³´ë‹¤ ëˆˆì´ ë§ê³ , ì‚¬ëŒë³´ë‹¤ ì†Œë¬¸ì´ ë¹ ë¥´ë‹¤.",
          lines: [
            "ë°”ëŒì´ ë¬´ê²ê²Œ ê¹”ë ¤ ìˆìŠµë‹ˆë‹¤. êµ¬ë¦„ì€ ë„ì‹¬ì˜ ì²¨íƒ‘ ì•„ë˜ë¡œ ë‚´ë ¤ì•‰ì•˜ìŠµë‹ˆë‹¤. í”¼ê³¤í•œ ê±¸ìŒë“¤ì´ ì €ë§ˆë‹¤ ëŒë°”ë‹¥ ìœ„ë¥¼ ìŠ¤ì¹˜ë©° ì§€ë‚˜ê°‘ë‹ˆë‹¤.",
            "ë‹¹ì‹ ì€ 1890 ë…„, ì„¸ê¸°ë§ì˜ íŒŒë¦¬ì— ìˆìŠµë‹ˆë‹¤. íŒŒë¦¬ì— ëŒ€í•œ ë‹¹ì‹ ì˜ ì¸ìƒì€ ì–´ë–¤ê°€ìš”?\n\n*(í”Œë ˆì´ì–´ ë‹µë³€ í™•ì¸)*",
            "ë‹¹ì‹ ì˜ í‰ê°€ê°€ ì–´ë–»ë“  ì´ê³³ì—ì„œ ë§ˆë„í•™ìì— ëŒ€í•œ ì†Œë¬¸ì€ ì¢…ì´ë³´ë‹¤ ì–‡ê³ , ê·¸ë³´ë‹¤ ë” ë¹ ë¥´ê²Œ í¼ì§‘ë‹ˆë‹¤.",
            "í˜„ì¬ ì—¬ëŸ¬ ì´ìœ ë¡œ íŒŒë¦¬ì— ì²´ë¥˜ ì¤‘ì¸ ë‹¹ì‹ ì€ ìˆ±í•˜ê²Œ ë§ˆë„í•™ìì— ëŒ€í•œ ë‚™ì„œì™€ ì¸ê°„ë“¤ì˜ ëƒ‰ì†Œ, ì‹œìœ„ ì „ë‹¨, ê·¸ë¦¬ê³  ì¹¨ë¬µì„ ëª©ê²©í•´ ì™”ìŠµë‹ˆë‹¤.",
            "ì–¸ì œë“  ê³ ê°œë¥¼ ëŒë¦¬ë©´ ë²½ì— ë§ˆë„í•™ìë¥¼ ì¡°ë¡±í•˜ëŠ” ë‚™ì„œê°€ ìˆìŠµë‹ˆë‹¤. â€˜Nous ne voulons pas de vous!â€™ ì´ë ‡ê²Œìš”. â€˜ìš°ë¦¬ëŠ” ë„ˆí¬ë¥¼ ì›í•˜ì§€ ì•ŠëŠ”ë‹¤!â€™ë¼ë‹ˆ. ê°•ë ¬í•˜ê¸°ë„ í•˜ì§€ìš”.",
            "ê·¸ë¦¬ê³  ëŒ€ê²°ì´ë¼ë„ í•˜ë“¯ ë‹¹ì‹ ì˜ ë°œë°‘ì—ëŠ” <ë§ˆë„í•™ìë„ ì¸ê°„ì´ë‹¤!>ë¼ëŠ” í¼ì§€ë§‰í•œ ì œëª©ì˜ ì‹ ë¬¸ í•œ ë©´ì´ ì°¢ê¸´ ì±„ ë’¹êµ½ë‹ˆë‹¤.\n\nì, ë‹¹ì‹ ì€ ë¬´ì–¼ í•  í…ê°€ìš”?",
          ],
          choices: [
            {
              text: "â¤ â€œë©ì²­í•œ ë‚™ì„œì•¼.â€ ë‚™ì„œë¥¼ ì†ëìœ¼ë¡œ ì§€ìš´ë‹¤. ì£¼ë³€ì˜ ì‹œì„ ì„ ëŠë¼ë©°, ì¡°ê¸ˆ ë” ì„¸ê²Œ ë¬¸ì§ˆëŸ¬ ë³¸ë‹¤.",
              pav: 0,
              rec: 2,
              rad: 1,
              mod: 0,
              log: "[ë¬´ëª¨í•œ ì •í™”ì]",
              mirrorLog: "ë²½ì„ ê¸ì–´ ë‚´ë˜ ê·¸ ìš©ê°í•œ ê²°ì˜",
              res: [
                "ê±°ì¹œ ëŒë²½ì— ì†ì„ ëŒ€ì, ì„œëŠ˜í•œ ê°ì´‰ê³¼ í•¨ê»˜ ë¨¸ë¦¿ì†ì—ì„œ ëª©ì²­ ì¢‹ì€ ëª©ì†Œë¦¬ê°€ ìš¸ë ¤ í¼ì§‘ë‹ˆë‹¤.",
                "???: ì´ ê±°ì¹œ ëŒë²½ì„ ë´. ì´ê±´ ë„ì „ì¥ì´ì•¼. ë„¤ ì†ê°€ë½ì´ ë­‰ê°œì§€ë“ , ì € í˜ì˜¤ìŠ¤ëŸ¬ìš´ ë¬¸ì¥ì´ ì‚¬ë¼ì§€ë“  ë‘˜ ì¤‘ í•˜ë‚˜ëŠ” ê²°íŒì´ ë‚˜ì•¼ì§€. ì, ë” ì„¸ê²Œ ë¬¸ì§ˆëŸ¬! ì´ ì¦ì˜¤ë¥¼ ì§€ì›Œ ë²„ë¦´ ìˆ˜ë§Œ ìˆë‹¤ë©´ ì†í†±ì¯¤ì´ì•¼ ê¸°êº¼ì´ ì§€ë¶ˆí•  ìˆ˜ ìˆì–ì•„?",
                "ë¨¸ì§€ ì•Šì•„ ë‹¹ì‹ ì˜ ì†ëì´ ë¶‰ê²Œ ë‹¬ì•„ì˜¤ë¦…ë‹ˆë‹¤. ì§€ì›Œì§€ì§€ ì•ŠëŠ” ë‚™ì„œ ìœ„ë¡œ ìƒˆë¡œìš´ ê²°ì˜ê°€ ë§ì¹ í•´ì§‘ë‹ˆë‹¤.",
                "ë‹¹ì‹ ì€ [ë¬´ëª¨í•œ ì •í™”ì]ê°€ ë˜ì–´ ì„¸ìƒì„ ë°”ë¼ë´…ë‹ˆë‹¤. ì´ì œ ì„¸ìƒì˜ ì–¼ë£©ì„ ì§€ìš¸ ìˆ˜ ìˆë‹¤ê³  ë¯¿ëŠ” ì˜¤ë§Œí•¨, í˜¹ì€ ìˆ­ê³ í•¨ì— ëŒ€í•˜ì—¬ í•¨ê»˜ ìƒê°í•´ ë´…ì‹œë‹¤.",
                "ë²½ì— ìƒˆê²¨ì§„ ë¬¸ì¥ì€ ì§€ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ê·¸ ë¬¸ì¥ì„ ì“´ ìì˜ ë§ˆìŒì† ê¹Šì€ ê³³ê¹Œì§€ ì†ì„ ë»—ì–´ ê¸ì–´ ë‚¼ ìˆ˜ ìˆì„ê¹Œìš”? ë‹¹ì‹ ì€ ì§€ê¸ˆ ëŒë²½ê³¼ ì‹¸ìš°ëŠ” ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤. ì´ ë„ì‹œ ì „ì²´ì˜ ë³´ì´ì§€ ì•ŠëŠ” ê³µê¸°ì™€ ì‹¸ìš°ê³  ìˆìŠµë‹ˆë‹¤.",
              ],
            },
            {
              text: "â¤ â€œì´ ë„ì‹œëŠ” ë²½ë³´ë‹¤ ëˆˆì´ ë§ì§€.â€ ê³ ê°œë¥¼ ëŒë¦¬ê³  ê±·ëŠ”ë‹¤. ë‚™ì„œê°€ ì•„ì§ ì–¼êµ´ ì—†ëŠ” êµ°ì¤‘ì¸ í•œ ë²½ì€ ê·¸ì € ë²½ì¼ ë¿ì´ê³ , ë‹¹ì‹ ì€ í”¼ë¡œí•˜ë‹¤.",
              pav: 2,
              rec: 0,
              rad: 0,
              mod: 1,
              log: "[ë³´ë„ë¸”ë¡ì˜ ì² í•™]",
              mirrorLog: "ì‹œì„ ì„ ëŒë¦¬ê³  ê±·ë˜ ê·¸ íˆ¬ëª…í•œ ë“±ë²ˆí˜¸",
              res: [
                "ë‹¹ì‹ ì€ ì™¸íˆ¬ì˜ ê¹ƒì„ ì„¸ìš°ê³  ì‹œì„ ì„ ë°”ë‹¥ìœ¼ë¡œ ë–¨êµ½ë‹ˆë‹¤. ê·¸ë•Œ, ëª½í™˜ì ì´ê³  ë‚®ì€ ì†ì‚­ì„ì´ ë‹¹ì‹ ì˜ ë°œê±¸ìŒì„ ë”°ë¼ì˜µë‹ˆë‹¤.",
                "???: ë°œë°‘ì„ ë´. ë³´ë„ë¸”ë¡ ì‚¬ì´ì˜ í‹ˆìƒˆë“¤ì´ ë„ˆë¥¼ ë¹„ì›ƒê³  ìˆì–´. í•˜ì§€ë§Œ ê´œì°®ì•„. ë„¤ê°€ ë³´ì§€ ì•Šìœ¼ë©´ ê·¸ê²ƒë“¤ë„ ë„ˆë¥¼ ë³´ì§€ ëª»í•  ê±°ì•¼. ë„Œ ì´ì œ ì‚¬ëŒì´ ì•„ë‹ˆë¼, ê±°ë¦¬ë¥¼ ë¶€ìœ í•˜ëŠ” ì°¨ê°€ìš´ ì•ˆê°œì¼ ë¿ì´ë‹ˆê¹Œ.",
                "ë‹¹ì‹ ì˜ ë¨¸ë¦¿ì†ì— [ë³´ë„ë¸”ë¡ì˜ ì² í•™]ì´ ìŒ“ì…ë‹ˆë‹¤. ì´ ì² í•™ì€ êµ°ì¤‘ ì†ì˜ ê³ ë…ì„ ì„ íƒí•œ ìê°€ ì–»ëŠ” ê¸°ë¬˜í•œ íˆ¬ëª… ë§í† ì™€ ë‹¤ë¥´ì§€ ì•Šì•„ ë³´ì…ë‹ˆë‹¤.",
                "ëˆˆì´ ë§ë‹¤ë©´ ëˆˆì„ ê°ìœ¼ë©´ ë©ë‹ˆë‹¤. ë‹¹ì‹ ì€ ìŠ¤ìŠ¤ë¡œë¥¼ í’ê²½ ì†ìœ¼ë¡œ ìœ ë°° ë³´ëƒˆìŠµë‹ˆë‹¤. íˆ¬ëª…í•´ì§„ë‹¤ëŠ” ê²ƒì€ ì•ˆì „í•˜ì§€ë§Œ, ë™ì‹œì— ëˆ„êµ¬ì—ê²Œë„ ë‹¿ì§€ ëª»í•œë‹¤ëŠ” ëœ»ì´ê¸°ë„ í•  ê²ë‹ˆë‹¤. ë‹¹ì‹ ì€ ìœ ë ¹ì´ ë˜ê¸°ë¥¼ ì„ íƒí–ˆì§€ë§Œ, ì„¬ëœ©í•˜ê²Œë„, ì´ë¯¸ ìœ ë ¹ì´ì—ˆì„ì§€ë„ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤.",
              ],
            },
            {
              text: "â¤ â€œì‹¤ë¡€í•©ë‹ˆë‹¤. í˜¹ì‹œ ë‹¤ë¥¸ ê³³ì—ì„œë„ ì´ëŸ° ë‚™ì„œë¥¼ ë³´ì…¨ë‚˜ìš”?â€ ë˜ë ·í•œ ëª©ì†Œë¦¬ë¡œ ì˜† ì‚¬ëŒì—ê²Œ ë¬»ëŠ”ë‹¤.",
              pav: 0,
              rec: 1,
              rad: 0,
              mod: 0,
              log: "[ì‚¬íšŒì  ë°œí™”ì ]",
              mirrorLog: "íƒ€ì¸ì—ê²Œ ê¸ˆê¸°ë¥¼ ë¬»ë˜ ê·¸ ë¶ˆìˆœí•œ í˜¸ê¸°ì‹¬",
              res: [
                "ë‹¹ì‹ ì˜ ëª©ì†Œë¦¬ê°€ ì°¨ê°€ìš´ ê³µê¸°ë¥¼ ê°€ë¦…ë‹ˆë‹¤. ì˜†ì— ì„œ ìˆë˜ ì‚¬ë‚´ì˜ ì–´ê¹¨ê°€ ì›€ì°”í•˜ê³  ë–¨ë¦¬ëŠ” ìˆœê°„, ë‚ ì¹´ë¡œìš´ ë¶„ì„ì´ ë‹¹ì‹ ì˜ ë‡Œë¦¬ë¥¼ ìŠ¤ì¹©ë‹ˆë‹¤.",
                "???: ë°©ê¸ˆ ë´¤ì–´? ì € ì‹ ì‚¬ì˜ ëˆˆë™ìê°€ ìˆ˜ì¶•í•˜ëŠ” ê²ƒ. ì§ˆë¬¸ í•˜ë‚˜ë¡œ ì •ì ì„ ê¹¨ëœ¨ë¦¬ëŠ” ê±´ ì •ë§ ì§œë¦¿í•œ ì¼ì´ì§€. ë„Œ ì§€ê¸ˆ í‰í™”ë¼ëŠ” ì´ë¦„ì˜ ì–‡ì€ ì–¼ìŒíŒ ìœ„ì— ëŒì„ ë˜ì§„ ê±°ì•¼. ì´ì œ ê¸ˆì´ ê°€ê¸° ì‹œì‘í•˜ê² ì§€. ì, ë‹¤ìŒì€ ì–´ë””ì— ëŒì„ ë˜ì§ˆ ê±°ì§€?",
                "ì´ê²ƒìœ¼ë¡œ ë‹¹ì‹ ì˜ ë‚´ë©´ì—ëŠ” [ì‚¬íšŒì  ë°œí™”ì ]ì´ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤. ê¸ˆê¸°ì–´ë¥¼ ì… ë°–ìœ¼ë¡œ ë‚´ë±‰ëŠ” ìˆœê°„ ë°œìƒí•˜ëŠ” ë§ˆì°°ì—´ì˜ ê¸°ë¡ì…ë‹ˆë‹¤.",
                "ì§ˆë¬¸ì€ ëŒ€ë‹µì„ ê°•ìš”í•˜ê³ , ëŒ€ë‹µì€ ì…ì¥ì„ ê°•ìš”í•©ë‹ˆë‹¤. ì¹¨ë¬µí•˜ëŠ” ë„ì‹œì—ì„œ ë§ì„ ê±°ëŠ” í–‰ìœ„ëŠ” ê·¸ ìì²´ë¡œ ì •ì¹˜ì ì…ë‹ˆë‹¤. ë‹¹ì‹ ì€ ì´ì œ ê±´ì „í•œ ì²´ë¥˜ìê°€ ì•„ë‹ˆë¼ ë¶ˆì”¨ë¥¼ ë“¤ê³  í™”ì•½ê³ ë¥¼ ê±°ë‹ˆëŠ” ìˆ˜ì‚¬í•™ìê°€ ë˜ê¸°ë¡œ í•œ ëª¨ì–‘ì…ë‹ˆë‹¤.",
              ],
            },
            {
              text: "â¤ ì‹ ë¬¸ì„ ì§‘ì–´ ë“ ë‹¤. ì´ë¯¸ ì ˆë°˜ì¯¤ ì°¢ê¸´ ê¸€ìë¥¼ ë“¤ê³  ì˜†ì˜ ì‚¬ëŒì—ê²Œ ë¬»ëŠ”ë‹¤. â€œì´ ê¸°ì‚¬, ë©°ì¹ ì ê±´ê°€ìš”?â€",
              pav: 2,
              rec: 0,
              rad: 1,
              mod: 0,
              log: "[í¸ì§‘ëœ ì„¸ê³„ê´€]",
              mirrorLog: "ì°¢ê¸´ ì‹ ë¬¸ì§€ ì¡°ê°ì„ ì´ì–´ ë¶™ì´ë˜ ê·¸ ì‹ ì¤‘í•œ ì†ê¸¸",
              res: [
                "ë‹¹ì‹ ì˜ ëª©ì†Œë¦¬ê°€ ì°¨ê°€ìš´ ê³µê¸°ë¥¼ ê°€ë¦…ë‹ˆë‹¤. ë„ˆëœê±°ë¦¬ëŠ” ì‹ ë¬¸ì„ íë—ê±°ë¦¬ëŠ” í–‰ì¸ì˜ ì‹œì„ ì´ ë¬´ê°í•©ë‹ˆë‹¤. ì–´ë–¤ ì§ê°ì´ ë‹¹ì‹ ì˜ ë‡Œë¦¬ë¥¼ ìŠ¤ì¹©ë‹ˆë‹¤.",
                "???: ì°¢ì–´ì§„ ê°ë„ 45 ë„. ì‰í¬ì˜ ì‚°í™” ì •ë„ë¥¼ ë³´ë‹ˆ ì´í‹€ ì „ ì¸ì‡„ëœ ê²ƒì´êµ°. ì •ë³´ëŠ” ë„ë ¤ ìˆì–´. ë‹¤ë§Œ ì‚¬ëŒë“¤ì´ ê·¸ê±¸ ë°œë¡œ ì§“ë°Ÿê³  ì§€ë‚˜ê°ˆ ë¿ì´ì§€. ì°¢ê¸´ ì‹ ë¬¸ì§€ ì¡°ê°, ì‰í¬ì˜ ë²ˆì§, ë²„ë ¤ì§„ ë‚ ì§œâ€¦. ì´ íŒŒí¸ë“¤ì„ ì´ì–´ ë¶™ì—¬ ë´.",
                "ë‹¹ì‹ ì€ ì´ì œ [í¸ì§‘ëœ ì„¸ê³„ê´€]ì´ë¼ëŠ” ë Œì¦ˆë¥¼ í†µí•´ ì„¸ìƒì„ ì¬êµ¬ì„±í•©ë‹ˆë‹¤. í™œìì™€ í˜„ì‹¤ ì‚¬ì´ì˜ ê´´ë¦¬ì—ì„œ ì˜¤ëŠ” ì¸ì§€ ë¶€ì¡°í™”ì˜ ê²°ê³¼ë¬¼ì…ë‹ˆë‹¤.",
                "ì„¸ìƒì€ í…ìŠ¤íŠ¸ë¡œ ì´ë£¨ì–´ì ¸ ìˆê³ , ë‹¹ì‹ ì€ ê·¸ í¸ì§‘ìì…ë‹ˆë‹¤. ì°¢ê¸´ ê¸°ì‚¬ ì†ì—ì„œ ì§„ì‹¤ì„ ì°¾ìœ¼ë ¤ëŠ” ì‹œë„ëŠ” ìˆ­ê³ í•˜ì§€ë§Œ ìœ„í—˜í•©ë‹ˆë‹¤. ëˆ„êµ°ê°€ ì˜ë„ì ìœ¼ë¡œ ì •ë³´ë¥¼ ì°¢ì–´ ë²„ë ¸ë‹¤ë©´, ê·¸ ë¹ˆì¹¸ì—ëŠ” ë¬´ì—‡ì´ ë“¤ì–´ ìˆì–´ì•¼ í• ê¹Œìš”? ë‹¹ì‹ ì€ ì´ì œ ê³µë°±ì„ ì½ëŠ” ë²•ì„ ë°°ì›Œì•¼ í•  ê²ë‹ˆë‹¤.",
              ],
            },
          ],
        },
        {
          title: "ì œ2 ë§‰: La date inconnue",
          subtitle: "â€” ì´ë¦„ì„ ë¬»ì§€ ì•ŠëŠ” ë„ì‹œëŠ” ë‹¹ì‹ ì„ ëª¨ë¥¸ë‹¤.",
          lines: [
            "ê±¸ìŒì„ ì˜®ê²¨ ë´…ì‹œë‹¤. ì§€ê¸ˆ ë‹¹ì‹ ì€ ì €ë… ë¬´ë µ ë¦¬ì˜¹ ì—­ ê·¼ì²˜ì— ìˆìŠµë‹ˆë‹¤. ê¸°ì°¨ê°€ ë„ì°©í•˜ì§€ ì•ŠëŠ” ë§‰ê°„ì˜ ì‹œê°„. ì •í•´ì§„ íë¦„ ì—†ì´ êµ°ì¤‘ë“¤ì´ ëª¨ì˜€ë‹¤ê°€ í©ì–´ì§‘ë‹ˆë‹¤.",
            "ë‹¹ì‹ ì€ ê¸°ì°¨ì—­ ì•, ì•„ì£¼ í¬ê³  ì˜¤ë˜ëœ ì‹œê³„ ì•„ë˜ì—ì„œ ì ì‹œ ë©ˆì¶¥ë‹ˆë‹¤. ì†Œë€í•©ë‹ˆë‹¤. ê°€ë°©ì„ ë‚´ë˜ì§€ëŠ” ì—¬í–‰ì, ëˆ„êµ°ê°€ë¥¼ ë°°ì›…í•˜ëŠ” ì´ë“¤, ì¹¨ë¬µí•œ ì±„ ë‹´ë°°ë¥¼ í”¼ìš°ëŠ” ì²­ë…„â€¦â€¦. ë‹¤ë“¤ ë°”ì˜ê²Œ ì›€ì§ì´ì§€ë§Œ, ì •ì‘ ì–´ë””ë¡ ê°€ â€˜ê°€ëŠ”â€™ ì‚¬ëŒì€ ë³„ë¡œ ì—†ë‹¤ëŠ” ì‚¬ì‹¤ì„, ë©ˆì¶”ì–´ ì„  ë‹¹ì‹ ì€ ì•Œì•„ë³´ì•˜ì„ì§€ë„ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤.",
            "ê·¸ë¦¬ê³  ê·¸ ì‚¬ì´ë¡œ, ì‘ê³  ì¡°ìš©í•˜ê²Œ ë…¸ì  í•˜ë‚˜ê°€ ë³´ì…ë‹ˆë‹¤. ë‹¹ì‹ ì´ ë…¸ì  ì• ì¢…ì´ ë”ë¯¸ë¥¼ í–¥í•´ ì²œì²œíˆ ë‹¤ê°€ê°€ì ë…¸ì ìƒì˜ ë…¸ì¸ì€ ì‹ ë¬¸ì„ ì •ë¦¬í•˜ë˜ ì†ì„ ë©ˆì¶”ê³ ëŠ” ë‹¹ì‹ ì„ í˜ë— ì³ë‹¤ë´…ë‹ˆë‹¤. \n\nâ€œê·¸ê±° ì‚´ ê±°ìš”?â€",
            "ê·¸ë¦¬ê³ ëŠ” ë‹¹ì‹ ì—ê²Œ ë‹¤ê°€ì™€ ì¢…ì´, ì •í™•íˆ ì‹ ë¬¸ ë”ë¯¸ì—ì„œ í•œ ì¥ì„ êº¼ë‚´ì–´ ì ‘ê³ ì„œëŠ”, ë¤ë¤í•˜ê²Œ ë§ì„ ì‡ìŠµë‹ˆë‹¤.\n\nâ€œë²Œì¨ ì˜¤ëŠ˜ì€ ë©€ì–´ì¡Œê³ , ì´ì œ ë‚´ì¼ì´ ë” ê°€ê¹Œìš´ ì‹œê°„ì¸ë°.â€",
            "ë…¸ì¸ì€ ì ì‹œ ëœ¸ì„ ë“¤ì´ë”ë‹ˆ ë‹¹ì‹ ì„ íë”ê±°ë¦¬ë©° ì³ë‹¤ë´…ë‹ˆë‹¤. ì–‘ì‹¬ì— ë”°ë¥¼ì§€ ë§ì§€ ê³ ë¯¼í•˜ë‹¤ê°€, ì´ë‚´ ì‹ ë¬¸ì„ íŒ”ê¸°ë¡œ ê²°ì‹¬í•œ ëª¨ì–‘ì…ë‹ˆë‹¤.",
            "â€œë­, ì‚¬ëŒë§ˆë‹¤ ë‹¤ ì‚¬ëŠ” ë°©ì‹ì´ ìˆëŠ” ê±°ì§€. ê¸°ì°¨ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ë™ì•ˆ ë‹¤ ì½ì–´ ë²„ë¦° ì‹ ë¬¸ì„ ê·¸ëŒ€ë¡œ ë²„ë¦´ì§€, ì£¼ë¨¸ë‹ˆì— ë„£ì„ì§€, ì•„ë‹ˆë©´ ì°¢ì–´ì„œ ë°”ëŒì— ë‚ ë¦´ì§€ëŠ” ì˜¤ì§ ìê¸° ìì‹ ë§Œ ì•„ëŠ” ê²ƒì²˜ëŸ¼.â€",
            "ê·¸ëŠ” ë‹¹ì‹  ì•ì— ì‹ ë¬¸ í•œ ì¥ì„ ë‚´ë°‰ë‹ˆë‹¤. ëª¨í‰ì´ê°€ ì ‘í˜€ ìˆì–´ ë‚´ìš©ì€ ë³´ì´ì§€ ì•Šê³ , ëŒ€ì‹  ëˆ„êµ°ê°€ í˜ë¦° ì‰í¬ê°€ ì–¼ë£©ì²˜ëŸ¼ ë„íŠ¸ë¨¸ë¦¬ì— ë‚¨ì•„ ìˆìŠµë‹ˆë‹¤.",
            "â€œë‚´ ë‚˜ì´ì¯¤ ì‚´ë‹¤ ë³´ë©´, ê°„ì§í•œë‹¤ê³  ë‚¨ëŠ” ê²Œ ì•„ë‹ˆê³ , ë²„ë¦°ë‹¤ê³  ìŠëŠ” ê²Œ ì•„ë‹ˆë©°, ì½ì§€ ì•ŠëŠ”ë‹¤ê³  ëª¨ë¥´ëŠ” ê²Œ ì•„ë‹ˆë¼ëŠ” ì‚¬ì‹¤ì„ ìì—°ìŠ¤ëŸ½ê²Œ ì•Œê²Œ ë˜ì§€.â€",
            "ë…¸ì¸ì´ íˆ¬ë°•í•œ ì†ìœ¼ë¡œ ì‹ ë¬¸ì„ ê±´ë„µë‹ˆë‹¤. ë‚˜ì˜¨ ì†ì´ ë‹¤ì‹œ ëŒì•„ê°€ì§€ ì•ŠìŠµë‹ˆë‹¤. ì•„! ë‹¹ì‹ ì€ ê·¸ì œì•¼ ê¹¨ë‹«ê³  ì£¼ë¨¸ë‹ˆì—ì„œ í†±ë‹ˆ ë™ì „ ëª‡ ê°œë¥¼ ì„¸ì–´ ê±´ë„µë‹ˆë‹¤. ë…¸ì¸ì€ ë§Œì¡±ìŠ¤ëŸ½ê²Œ ê³ ê°œë¥¼ ë„ë•ì…ë‹ˆë‹¤.",
            "â€œì´ ì €ë…ì— ì»¤í”¼ê°’ì„ ë²Œê²Œ í•´ ì¤€ ê·€í•œ ì†ë‹˜ì—ê²Œ ì´ ë…¸ì¸ë„¤ê°€ ì§ˆë¬¸ í•˜ë‚˜ë§Œ í•˜ì§€. ë§Œì•½ ë‹¹ì‹ ì´ ì‹ ë¬¸ì„ ì½ê³  ì„¸ìƒì— ë”± í•˜ë‚˜ë§Œ ë‚¨ê¸¸ ìˆ˜ ìˆë‹¤ë©´ ì–´ë–»ê²Œ í•  ê±°ìš”? ê¸°ì–µì´ìš”, ì•„ë‹ˆë©´ ê¸°ë¡?â€",
          ],
          choices: [
            {
              text: "â¤ â€œê¸°ì–µ. ë‚´ê°€ ìŠì§€ ì•Šìœ¼ë©´ ë˜ëŠ” ê±°ì£ .â€",
              pav: 0,
              rec: 2,
              rad: 0,
              mod: 1,
              log: "[ê³ ë…í•œ ë³´ê´€ì†Œ]",
              mirrorLog: "ìì‹ ì˜ ë‚´ë©´ìœ¼ë¡œ ì¹¨ì í•˜ë˜ ê·¸ ê³ ë…í•œ ì„œì¬",
              res: [
                "ë‹¹ì‹ ì˜ ëŒ€ë‹µì„ ë“¤ì€ ë…¸ì¸ì´ ì§§ê²Œ ì›ƒìŠµë‹ˆë‹¤. ë…¸ì¸ì€ ë‹¹ì‹ ì„ ë‘ê³  â€˜ì˜¤ë˜ ê±¸ì–´ì„œ ì™¸ë¡œì›Œì§ˆ ì²­ë…„â€™ì´ë¼ê³  ë‹¤ì†Œ ì˜ë¯¸ì‹¬ì¥í•œ íˆ¬ë¡œ ì˜ˆê²¬í•©ë‹ˆë‹¤. ë‹¹ì‹ ì˜ ë¯¸ë˜ë¥¼ ë¯¸ë¦¬ ë³´ê¸°ë¼ë„ í•œ ê±¸ê¹Œìš”? ê·¸ë¦¬ê³  ê·¸ ë¶€ë“œëŸ¬ìš´ ëª©ì†Œë¦¬ê°€ ê³µëª…í•  ë•Œ, ë‹¹ì‹ ì˜ ë¨¸ë¦¿ì† ê¹Šì€ ê³³ì—ì„œ ì•„ë“í•œ ìš¸ë¦¼ì´ ë²ˆì§‘ë‹ˆë‹¤.",
                "???: ë§ì•„. ì¢…ì´ëŠ” ì©ê³  ì‰í¬ëŠ” ë°”ë˜ì§€ë§Œ, ë„¤ ì˜í˜¼ì— ìƒˆê²¨ì§„ ê°ê°ì€ ì˜ì›íˆ ë°•ì œë  ê±°ì•¼. ê¸°ë¡ë˜ì§€ ì•Šì€ ì§„ì‹¤ë§Œì´ ì§„ì§œ ì§„ì‹¤ì´ì§€. ë„Œ ì´ì œ ì´ ë„ì‹œì˜ ë³´ì´ì§€ ì•ŠëŠ” ë„ì„œê´€ì´ ë˜ëŠ” ê±°ì•¼. ì•„ë¬´ë„ ë¹Œë¦´ ìˆ˜ ì—†ê³ , ì˜¤ì§ ë„ˆë§Œì´ ì½ì„ ìˆ˜ ìˆëŠ” ì±…ë“¤ë¡œ ê°€ë“ ì°¬ ë„ì„œê´€ ë§ì´ì•¼.",
                "ë‹¹ì‹ ì˜ ë‚´ë©´ì—ëŠ” [ê³ ë…í•œ ë³´ê´€ì†Œ]ë¼ëŠ” ìƒê°ì´ ìë¦¬ ì¡ìŠµë‹ˆë‹¤. ê°„ì§í•œë‹¤ê³  ë‹¤ ë‚¨ëŠ” ê²ƒì€ ì•„ë‹ˆë¼ëŠ” ë…¸ì¸ì˜ ë§ì„ ë“£ê³  ë‚œ ë‹¹ì‹ ì€ ì´ì œ í˜•íƒœ ì—†ëŠ” ê²ƒë“¤ì— ë” ê´€ì‹¬ì´ ê°€ê²Œ ë ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤.",
                "ê¸°ì–µì€ ê¸°ë¡ë³´ë‹¤ ìœ„ëŒ€í•˜ì§€ë§Œ, ê·¸ ëŒ€ê°€ëŠ” ì˜ì›íˆ í˜¼ì ì§Šì–´ì ¸ì•¼ í•  ë¬´ê²Œì…ë‹ˆë‹¤. ë‹¹ì‹ ì´ ìŠëŠ” ìˆœê°„, ê·¸ ì„¸ê³„ëŠ” ì •ë§ë¡œ ì‚¬ë¼ì§ˆ í…Œë‹ˆê¹Œìš”.",
              ],
            },
            {
              text: "â¤ â€œê¸°ë¡. ê²°êµ­ ëˆ„êµ°ê°€ê°€ ì•Œì•„ì•¼ í•˜ë‹ˆê¹Œìš”.â€",
              pav: 2,
              rec: 0,
              rad: 1,
              mod: 0,
              log: "[ì‰í¬ì˜ ê¶Œìœ„]",
              mirrorLog: "ì‰í¬ì˜ ë†ë„ë¡œ ì§„ì‹¤ì„ ì¬ë‹¨í•˜ë˜ ê·¸ ëƒ‰ì •í•œ í¸ì§‘ì¦",
              res: [
                "â€œë§ëŠ” ë§ì´ì•¼. ê·¸ë˜ì„œ ìš”ì¦˜ì€ ê·¸ê±¸ ëˆ„ê°€ ì“°ëŠ”ì§€ê°€ ì¤‘ìš”í•œ ì„¸ìƒì´ì§€.â€ ë…¸ì¸ì´ ì‹ ë¬¸ì„ ë°˜ ì ‘ìœ¼ë©° ë§í•©ë‹ˆë‹¤. ë”± ë§ê²Œ ì ‘íˆì§€ ì•ŠëŠ” ì¢…ì´ì˜ ì§ˆê°ì„ ì§€ì¼œë³´ëŠ” ë‹¹ì‹ ì˜ ëˆˆì— ì˜ˆë¦¬í•œ ê´‘ì±„ê°€ ìŠ¤ì¹©ë‹ˆë‹¤.",
                "???: í˜„ëª…í•œ ì„ íƒì´ì•¼. ê¸°ì–µì€ ì£¼ê´€ì ì´ê³  ë‚˜ì•½í•˜ì§€. í•˜ì§€ë§Œ ê¸°ë¡ì€ ê¶Œë ¥ì´ì•¼. ë„¤ê°€ ë‚¨ê¸´ í•œ ì¤„ì˜ ë¬¸ì¥ì´ í›—ë‚  ëˆ„êµ°ê°€ì—ê²ŒëŠ” ìœ ì¼í•œ ì§„ì‹¤ì´ ë  í…Œë‹ˆê¹Œ. ë¹„ë¡ ê·¸ ì¢…ì´ê°€ ë¹„ëš¤ê²Œ ì ‘íì§€ì–¸ì •, ì¡´ì¬í–ˆë‹¤ëŠ” ì¦ê±°ëŠ” ë‚¨ê²¨ì•¼ì§€. ê·¸ê²Œ ìš°ë¦¬ê°€ ì´ í˜¼ë€ìŠ¤ëŸ¬ìš´ ì„¸ê¸°ë§ì„ ë²„í…¨ ë‚´ëŠ” ìœ ì¼í•œ ë°©ì‹ ì•„ë‹ˆê² ì–´?",
                "ë‹¹ì‹ ì€ ì´ì œ [ì‰í¬ì˜ ê¶Œìœ„]ë¼ëŠ” ê´€ì ìœ¼ë¡œ ì„¸ìƒì„ ì¬ë‹¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê²°êµ­ ëˆ„êµ°ê°€ê°€ ì•Œì•„ì•¼ í•œë‹¤ëŠ” ë‹¹ì‹ ì˜ ë¯¿ìŒì€, ì‚¬ì‹¤ì„ ì—­ì‚¬ê°€ ë˜ê²Œ ë§Œë“­ë‹ˆë‹¤. í•˜ì§€ë§Œ ì¡°ì‹¬í•©ì‹œë‹¤. ê¸°ë¡í•˜ëŠ” ì†ì€ ì–¸ì œë‚˜ ì™œê³¡ì˜ ìœ í˜¹ì— ë…¸ì¶œë˜ì–´ ìˆìœ¼ë‹ˆê¹Œìš”. ë‹¹ì‹ ì´ ë‚¨ê¸´ ë¬¸ì¥ì€ ë‹¹ì‹ ì˜ ì˜ë„ëŒ€ë¡œ ì½íê¹Œìš”, ì•„ë‹ˆë©´ ì½ëŠ” ì´ì˜ ìš•ë§ëŒ€ë¡œ ì½íê¹Œìš”?",
              ],
            },
            {
              text: "â¤ â€œê¸€ì„ìš”. ë‘˜ ë‹¤ ìŠíˆì§€ ì•Šìœ¼ë©´ ì¢‹ê² ë„¤ìš”.â€",
              pav: 1,
              rec: 1,
              rad: 0,
              mod: 0,
              log: "[ì–‘ë©´ì˜ ëª¨ìˆœ]",
              mirrorLog: "ê¸°ì–µê³¼ ê¸°ë¡ì„ ëª¨ë‘ ì¥ë ¤ë˜ ê·¸ ì•¼ì‹¬ì°¬ ì–‘ì†",
              res: [
                "â€œí•˜ë‚˜ ë‚¨ê¸°ê¸°ë„ ë²…ì°¬ ì„¸ìƒì´ì§€ë§Œ, ê·¸ê±´ ë¶„ëª… íŒŒë¦¬ ì‹œë¯¼ì—ê²Œ ì–´ìš¸ë¦¬ëŠ” ëŒ€ë‹µì´êµ°.â€  ë…¸ì¸ì´ ê°€ë³ê²Œ ì›ƒëŠ” ì‚¬ì´, ë°”ëŒì´ ë…¸ì¸ì˜ ì†ì—ì„œ í•œ ì¥ì˜ ì‹ ë¬¸ì„ ë“¤ê³  ê°‘ë‹ˆë‹¤. ëˆ„êµ¬ì˜ ì´ì•¼ê¸°ì¸ì§€ë„ ëª¨ë¥¸ ì±„ ì´ì•¼ê¸°ê°€ ë– ë‚©ë‹ˆë‹¤.",
                "???: í•˜ë‚˜ë¥¼ íƒí•˜ë¼ëŠ” ì§ˆë¬¸ì— ë‘˜ ë‹¤ë¥¼ ì™¸ì¹˜ëŠ” ê±´ ìˆ˜í•™ì ìœ¼ë¡œëŠ” íƒìš•ì´ê³ , ì¸ë¬¸í•™ì ìœ¼ë¡œëŠ” ë‚­ë§Œì´ì§€. ê¸°ì–µì˜ íœ˜ë°œì„±ê³¼ ê¸°ë¡ì˜ ë°•ì œì„±ì„ ë™ì‹œì— ê±°ë¨¸ì¥ê² ë‹¤ëŠ” ê±´ê°€? ë¶ˆê°€ëŠ¥ì— ê°€ê¹ì§€ë§Œ, ì´ íŒŒë¦¬ë¼ëŠ” ê¸°ê´´í•œ ë„ì‹œì—ì„œëŠ” ì˜¤íˆë ¤ ê°€ì¥ í•©ë¦¬ì ì¸ ëª¨ìˆœì¼ì§€ë„ ëª°ë¼.",
                "ë‹¹ì‹ ì˜ ì •ì‹  í•œêµ¬ì„ì— [ì–‘ë©´ì˜ ëª¨ìˆœ]ì´ë¼ëŠ” ê¸°ë¬˜í•œ í™”ë‘ê°€ ë‚¨ìŠµë‹ˆë‹¤. í•˜ë‚˜ ë‚¨ê¸°ê¸°ë„ ë²…ì°¬ ì„¸ìƒì—ì„œ ë‹¹ì‹ ì€ ëª¨ë“  ê²ƒì„ ë¶™ì¡ìœ¼ë ¤ í•©ë‹ˆë‹¤. ë°”ëŒì— ë‚ ë ¤ê°€ëŠ” ì‹ ë¬¸ì²˜ëŸ¼ ì´ì•¼ê¸°ëŠ” ë– ë‚˜ê°€ê² ì§€ë§Œ, ë‹¹ì‹ ì€ ê·¸ ê¶¤ì ì„ ê¸°ì–µí•˜ë©´ì„œ ë™ì‹œì— ê·¸ ì†ë§›ì„ ê¸°ë¡í•˜ë ¤ í•  ê²ƒì…ë‹ˆë‹¤. ì´ ëì—†ëŠ” ìš•ì‹¬ì´ ë‹¹ì‹ ì„ êµ¬ì›í• ê¹Œìš”, ì•„ë‹ˆë©´ íŒŒë©¸ì‹œí‚¬ê¹Œìš”?",
              ],
            },
          ],
        },
        {
          title: "ì œ3 ë§‰: ë¶ˆí˜‘í™” ä¸å”åŒ–",
          subtitle: "â€” ì„¸ê³„ê°€ ì•„ì£¼ ì¡°ê¸ˆ ì–´ê¸‹ë‚˜ê¸° ì‹œì‘í–ˆì§€ë§Œ, ì•„ë¬´ë„ ê·¸ê²ƒì„ ì •í™•íˆ ì§€ì í•  ìˆ˜ ì—†ë‹¤.",
          lines: [
            "ì´ì œ í•´ê°€ ì„œì„œíˆ ì§€ê¸° ì‹œì‘í•˜ëŠ” ì €ë… ì‹œê°„. ì–´ë”˜ê°€ ìŠµí•˜ê³ , ë¶ˆì¾Œí•œ ì •ì . ë‹¹ì‹ ì€ ì•ì„œ ë§Œë‚œ ë…¸ì¸ê³¼ì˜ ì§§ì€ ëŒ€í™”ë¥¼ ë§ˆì¹˜ê³  í™€ë¡œ ê±·ê³  ìˆìŠµë‹ˆë‹¤.",
            "ê¸¸ì€ ë‚¯ìµì§€ë§Œ, ì–´ë”˜ê°€ ë¯¸ì„¸í•˜ê²Œ ì´ì§ˆê°ì´ ìˆìŠµë‹ˆë‹¤. ë‹¹ì‹ ì€ ì•„ì§ë„ ì´ ê±°ë¦¬ê°€ ë‚¯ì„  ê±¸ê¹Œìš”? ì•„ë‹ˆë©´ ê±°ë¦¬ê°€ ì—¬ì „íˆ ë‹¹ì‹ ì„ ë‚¯ì„¤ì–´í•˜ëŠ” ê±¸ì§€ë„ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤.",
            "ê³ ê°œë¥¼ ëŒë¦¬ì ìš°ëš ì„  ê±°ë¦¬ì˜ ì‹œê³„íƒ‘ì€ 11 ì‹œ 18 ë¶„ì„ ê°€ë¦¬í‚¤ê³  ìˆìŠµë‹ˆë‹¤. ì´ìƒí•œ ì‹œê°„ì…ë‹ˆë‹¤. ì§€ê¸ˆì€ ì˜¤í›„ 6 ì‹œë‚˜ 7 ì‹œì¯¤ ëì„ í…ë°ìš”. ê·¸ ì•ì„ ì§€ë‚˜ê°€ëŠ” íŒŒë¦¬ ì‹œë¯¼ë“¤ì€ ì‹œê³„ë¥¼ ì³ë‹¤ë³´ì§€ ì•ŠìŠµë‹ˆë‹¤.",
          ],
          choices: [
            {
              text: "â¤ â€œì´ìƒí•˜ë„¤.â€ ì‹œê³„ë¥¼ ë°”ë¼ë³¸ë‹¤. ë°œê±¸ìŒì„ ë©ˆì¶”ê³ , ê³ ê°œë¥¼ ë“ ë‹¤. ë‹¹ì‹ ì€ ìœ ì¼í•˜ê²Œ ì‘ì‹œí•˜ëŠ” ìê°€ ëœë‹¤.",
              pav: 0,
              rec: 3,
              rad: 2,
              mod: 0,
              log: "[ì§ì‹œí•˜ëŠ” ì˜ˆì–¸ì]",
              mirrorLog: "ë©ˆì¶˜ ì‹œê³„ë¥¼ ë³´ë©° ëŠê¼ˆë˜ ê·¸ ê¸°ë¬˜í•œ í•´ë°©ê°",
              res: [
                "ë‹¹ì‹ ì€ ê³ ê°œë¥¼ êº¾ì–´ ì‹œê³„íƒ‘ì˜ ì •ì§€ëœ ì´ˆì¹¨ì„ ë´…ë‹ˆë‹¤. ì£¼ë³€ì˜ íë¦¿í•œ ì¸íŒŒ ì‚¬ì´ì—ì„œ ì˜¤ì§ ë‹¹ì‹ ë§Œì´ ì´ ë¶€ì¡°ë¦¬í•œ í’ê²½ì˜ ëª©ê²©ìê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.",
                "???: ë‚¨ë“¤ì€ ê³ ê°œë¥¼ ìˆ™ì´ê³  ìš´ëª…ì— ìˆœì‘í•  ë•Œ, ë„ˆë§Œì€ ê·¸ ê¸°ê´´í•œ ì§„ì‹¤ì„ ì³ë‹¤ë³´ëŠ”êµ°. ê·¸ë˜, ì„¸ê³„ê°€ í‹€ë ¸ë‹¤ë©´ ë„¤ê°€ í‹€ë¦° ê²Œ ì•„ë‹ˆë¼ ì„¸ê³„ê°€ ê³ ì¥ ë‚œ ê±°ì•¼. ì € ë©ˆì¶˜ í†±ë‹ˆë°”í€´ ì†ì—ì„œ ë„Œ ë¬´ì—‡ì„ ë³´ê³  ìˆì§€? ë’¤í‹€ë¦° ì—­ì‚¬ì˜ í‹ˆìƒˆ? ì•„ë‹ˆë©´ ê³§ ë“¤ì´ë‹¥ì¹  ì§„ì •í•œ ì‹œëŒ€ì˜ ì˜ˆê³ í¸?",
                "ë‹¹ì‹ ì˜ ë‚´ë©´ì— [ì§ì‹œí•˜ëŠ” ì˜ˆì–¸ì]ë¼ëŠ” ê°ê°ì´ ê°ì¸ë©ë‹ˆë‹¤. ì´ìƒí•¨ì„ ì´ìƒí•˜ë‹¤ê³  ë§í•˜ëŠ” ìš©ê¸°ê°€ ë¬´ì—‡ê³¼ ë‹®ì•„ ìˆëŠ”ì§€ ì•„ì§ì€ ëª¨ë¦…ë‹ˆë‹¤. í•˜ì§€ë§Œ ì ì–´ë„ ë‹¹ì‹ ì€ ì´ì œ êµ°ì¤‘ì´ ë³´ì§€ ëª»í•˜ëŠ” â€˜ì§„ì§œ íŒŒë¦¬â€™ì˜ í˜•ìƒì„ ì½ì–´ ë‚´ê¸° ì‹œì‘í–ˆìŠµë‹ˆë‹¤. ì´ê²ƒì´ í†µì°°ì¸ì§€ ê´‘ê¸° ì†ìœ¼ë¡œì˜ ì²«ê±¸ìŒì¸ì§€ëŠ” ë¯¸ë˜ê°€ ë§í•´ ì¤„ ê²ƒì…ë‹ˆë‹¤.",
                "ì´ì œ ë¬´ì—‡ì„ í•  ìƒê°ì¸ê°€ìš”?\nâ¤ ì‹œê³„íƒ‘ìœ¼ë¡œ ì˜¬ë¼ê°€ ë©ˆì¶˜ í†±ë‹ˆë°”í€´ë¥¼ ì–µì§€ë¡œë¼ë„ ëŒë ¤ ë³¸ë‹¤.\nâ¤ ì´ ì‚¬ì‹¤ì„ ëª¨ë¥´ëŠ” êµ°ì¤‘ë“¤ì„ í–¥í•´ ë¯¸ì¹œ ë“¯ì´ ì†Œë¦¬ì¹œë‹¤.\n\n*(í”Œë ˆì´ì–´ ë‹µë³€ í™•ì¸)*",
                "???: ê·¸ë˜, ê·¸ê²Œ ë°”ë¡œ ë„¤ê°€ ê°€ì§„ ë‚ ì¹´ë¡œìš´ ë°œí†±ì´ì§€. ë‚¨ë“¤ì´ ë³´ì§€ ëª»í•˜ëŠ” ê²ƒì„ ë³´ê³ , ë‚¨ë“¤ì´ í•˜ì§€ ëª»í•˜ëŠ” ê²ƒì„ í•˜ê² ë‹¤ëŠ” ê·¸ ì˜¤ë§Œí•¨. í˜¹ì€ ê·¸ ìˆ­ê³ í•¨.",
                "ì‹œê³„íƒ‘ì˜ ê±°ëŒ€í•œ ê·¸ë¦¼ìê°€ ë‹¹ì‹ ì˜ ë°œì¹˜ê¹Œì§€ ê¸¸ê²Œ ëŠ˜ì–´ì§‘ë‹ˆë‹¤. ë‹¹ì‹ ì€ ê³ ê°œë¥¼ ëŒë ¤ ë‹¹ì‹ ì„ ìŠ¤ì³ ì§€ë‚˜ê°€ëŠ” ë¬´ì§€í•œ êµ°ì¤‘ë“¤ì„ ë°”ë¼ë´…ë‹ˆë‹¤. ê·¸ë“¤ì€ ì—¬ì „íˆ ê°€ì§œ íƒœì–‘ ì•„ë˜ ì‚´ê³  ìˆì§€ë§Œ, ì ì–´ë„ ë‹¹ì‹ ì€ ì´ë¯¸ ì§„ì‹¤ ì†ì— ì„œ ìˆìŠµë‹ˆë‹¤. ì´ ì‚¬ì‹¤ì´ ë‹¹ì‹ ì—ê²Œ ìœ„ì•ˆì´ ë˜ê² ì§€ìš”.",
              ],
            },
            {
              text: "â¤ â€œë­, íŒŒë¦¬ ì‹œê³„ ì¤‘ ì œëŒ€ë¡œ ë§ëŠ” ê²Œ ìˆë˜ê°€.â€ ì‹œì„ ì„ ì˜®ê¸°ê³ , ì´ ë¨¸ì €ë¦¬ ê°™ì€ ë„ì‹œë¥¼ ê³„ì†í•´ì„œ ê±·ëŠ”ë‹¤.",
              pav: 3,
              rec: 0,
              rad: 0,
              mod: 2,
              log: "[ì•ˆì •ì˜ ì™¸ë©´]",
              mirrorLog: "ì–´ê¸‹ë‚œ ì‹œê°„ì„ ëª» ë³¸ ì²™ ì§€ë‚˜ì¹˜ë˜ ê·¸ ì˜ë¦¬í•œ ë¬´ê´€ì‹¬",
              res: [
                "ë‹¹ì‹ ì€ ê°€ë³ê²Œ ì½”ì›ƒìŒì„ ì¹˜ë©° ë°œê±¸ìŒì„ ì˜®ê¹ë‹ˆë‹¤. ë¬´ì§ˆì„œí•œ ë„ì‹œì— ì§ˆì„œ ìˆëŠ” ì‹œê³„ ë”°ìœ„ëŠ” ì–´ìš¸ë¦¬ì§€ ì•ŠëŠ”ë‹¤ëŠ” ë“¯ ë§ì´ì£ . ê·¸ë•Œ, ì°¨ë¶„í•˜ê³  ê±´ì¡°í•œ ëª©ì†Œë¦¬ê°€ ë‹¹ì‹ ì˜ ê·“ê°€ì— ë“¤ë¦½ë‹ˆë‹¤.",
                "???: í•©ë¦¬ì ì¸ íŒë‹¨ì´ì•¼. ì € ê³ ì¥ ë‚œ ì‹œê³„ì— ì˜ë¯¸ë¥¼ ë¶€ì—¬í•˜ëŠ” ìˆœê°„, ë„¤ í‰ì˜¨í•œ í˜„ì‹¤ì€ ë¬´ë„ˆì§ˆ í…Œë‹ˆê¹Œ. ì˜¤ì°¨ë¥¼ ë¬´ì‹œí•˜ëŠ” ê²ƒì´ì•¼ë§ë¡œ ì§ˆì„œë¥¼ ìœ ì§€í•˜ëŠ” ê°€ì¥ íš¨ìœ¨ì ì¸ ë°©ë²•ì´ì§€. íŒŒë¦¬ì˜ ëª¨ë“  ì‹œê³„ê°€ ë¯¸ì³ ë²„ë ¤ë„, ë„¤ ë¨¸ë¦¿ì†ì˜ ì‹œê³„ë§Œ ì •í™•íˆ ì‘ë™í•˜ë©´ ê·¸ë§Œì´ì•¼. ì•ˆ ê·¸ë˜?",
                "ë‹¹ì‹ ì€ [ì•ˆì •ì˜ ì™¸ë©´]ì´ë¼ëŠ” ë°©ì–´ ê¸°ì œë¥¼ ì¥ì°©í•©ë‹ˆë‹¤. ë¶ˆì¼ì¹˜ë¥¼ ì¸ì‹í•˜ë˜ ê·¸ê²ƒì— ë§¤ëª°ë˜ì§€ ì•ŠëŠ” ëƒ‰ì •í•¨. ì´ì œ ë‹¹ì‹ ì€ ì•ˆì „í•´ì¡ŒìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ë‹¹ì‹ ì´ ë¬´ì‹œí•œ ê·¸ 5 ì‹œê°„ì˜ ê³µë°±ì´, ì •ë§ë¡œ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤ê³  í™•ì‹ í•  ìˆ˜ ìˆë‚˜ìš”?",
                "ë‹¹ì‹ ì€ ì •ë§ë¡œ ê·¸ ì‹œê³„ê°€ í‹€ë ¸ë‹¤ê³  ë¯¿ìŠµë‹ˆê¹Œ?\nâ¤ ë‹¹ì—°í•˜ë‹¤. ì €ê²ƒì€ ë‹¨ìˆœí•œ ê¸°ê³„ì  ê²°í•¨ì¼ ë¿ì´ë‹¤.\nâ¤ ì•„ë‹ˆ, ì‚¬ì‹¤ì€ ë¬´ì„­ë‹¤. ê·¸ë˜ì„œ ëˆˆì„ ëŒë¦¬ëŠ” ê²ƒë¿ì´ë‹¤.\n\n*(í”Œë ˆì´ì–´ ë‹µë³€ í™•ì¸)*",
                "???: íƒì›”í•œ ìê¸°í†µì œë ¥ì´ì•¼. í˜¼ëˆì— ì´ë¦„ì„ ë¶™ì—¬ ì£¼ëŠ” ìˆœê°„ ê·¸ê²ƒì€ ì‹¤ì²´ê°€ ë˜ì§€ë§Œ, ë¬´ì‹œí•˜ëŠ” ìˆœê°„ ê·¸ê²ƒì€ ë‹¨ì§€ ì¼ì‹œì ì¸ ì˜¤ë¥˜ì— ë¶ˆê³¼í•´ì§€ì§€. ë„Œ ì§€ê¸ˆ ì¸ë¥˜ê°€ ìŒ“ì•„ ì˜¬ë¦° ìƒì‹ì´ë¼ëŠ” ê±°ëŒ€í•œ ëŒì„ ìˆ˜í˜¸í•˜ê³  ìˆëŠ” ê±°ì•¼.",
                "ë‹¹ì‹ ì€ ííŠ¸ëŸ¬ì§„ í˜¸í¡ì„ ê°€ë‹¤ë“¬ê³  ë‹¤ì‹œ ê±·ê¸° ì‹œì‘í•©ë‹ˆë‹¤. ì‹œê³„íƒ‘ì˜ ì´ìƒí•œ ìˆ«ìëŠ” ì´ì œ ë‹¹ì‹ ì˜ ê¸°ì–µ ì†ì—ì„œ ë¹ ë¥´ê²Œ ì†Œê±°ë©ë‹ˆë‹¤. ì„¸ìƒì—ëŠ” ëª°ë¼ë„ ë˜ëŠ” ì§„ì‹¤ì´ ìˆê³ , ìœ ì§€ë˜ì–´ì•¼ë§Œ í•˜ëŠ” ê±°ì§“ì´ ìˆëŠ” ë²•ì…ë‹ˆë‹¤. í˜¼ë€ì€ í›Œë¥­í•˜ê²Œ ê²©ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¹ì‹ ì€ ì´ì œ í­í’ ì†ì—ì„œë„ í”ë“¤ë¦¬ì§€ ì•ŠìŠµë‹ˆë‹¤.",
              ],
            },
            {
              text: "â¤ ì£¼ë³€ ì‚¬ëŒì—ê²Œ ë¬»ëŠ”ë‹¤. â€œí˜¹ì‹œ ì € ì‹œê³„íƒ‘, ê³ ì¥ ë‚œ ê±´ê°€ìš”?â€",
              pav: 1,
              rec: 1,
              rad: 0,
              mod: 0,
              log: "[ê³µë²”ìë“¤ì˜ ì—°ëŒ€ê¸°]",
              mirrorLog: "íƒ€ì¸ì˜ ì…ì„ í†µí•´ ì§„ì‹¤ì„ í™•ì¸í•˜ë ¤ë˜ ê·¸ ê¸´ë°€í•œ ì‹ ë¢°",
              res: [
                "â€œí˜¹ì‹œ ì € ì‹œê³„íƒ‘, ê³ ì¥ ë‚œ ê±´ê°€ìš”?â€ ì•ˆíƒ€ê¹ì§€ë§Œ, ë‹¹ì‹ ì˜ ì§ˆë¬¸ì€ í—ˆê³µì— í©ì–´ì§‘ë‹ˆë‹¤. ëŒ€ë‹µ í•˜ë‚˜ ì—†ì´ ì§€ë‚˜ê°€ëŠ” ì´ë“¤ì˜ ë¬´ì‹¬í•œ í‘œì •ì„ ì‚´í”¼ëŠ” ë‹¹ì‹ ì˜ ë¨¸ë¦¿ì†ì—ì„œ ì—¬ëŸ¬ ëª©ì†Œë¦¬ê°€ ì–½íˆë©° ë¶ˆí˜‘í™”ìŒì„ ë§Œë“­ë‹ˆë‹¤.",
                "???: ì§ˆë¬¸ì„ ë˜ì§€ëŠ”êµ°. íƒ€ì¸ì˜ ë™ì˜ë¥¼ í†µí•´ ë„¤ ê°ê°ì˜ ì˜¤ë¥˜ë¥¼ ìˆ˜ì •í•˜ë ¤ëŠ” ê±´ê°€? ì•„ë‹ˆë©´ ì´ ì¹¨ë¬µí•˜ëŠ” ë„ì‹œì˜ ê³µë²”ìë“¤ì„ í™•ì¸í•˜ê³  ì‹¶ì€ ê±´ê°€? ë„Œ ì§€ê¸ˆ ì–¼ìŒíŒ ìœ„ì— ëŒì„ ë˜ì¡Œì§€ë§Œ, ì–¼ìŒì€ ê¹¨ì§€ì§€ ì•Šê³  ì˜¤íˆë ¤ ë„¤ ë°œë°‘ê¹Œì§€ ì–¼ì–´ë¶™ê³  ìˆì–´. ì´ ì¹¨ë¬µì˜ ê³µë²”ë“¤ ì‚¬ì´ì—ì„œ í˜¼ì ê¹¨ì–´ ìˆëŠ” ì´ë°©ì¸ì´ ëœ ê¸°ë¶„ì´ ì–´ë•Œ?",
                "ë‹¹ì‹ ì€ [ê³µë²”ìë“¤ì˜ ì—°ëŒ€ê¸°]ë¼ëŠ” í™”ë‘ë¥¼ ê°€ìŠ´ì— í’ˆìŠµë‹ˆë‹¤. ì´ì œ ë‹¹ì‹ ì˜ ì§ˆë¬¸ì€ ë‹µì„ ì–»ê¸° ìœ„í•¨ì´ ì•„ë‹ˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.",
                "ì¹¨ë¬µí•˜ëŠ” êµ°ì¤‘ë“¤ ì‚¬ì´ì—ì„œ ë‹¹ì‹ ì€ ì–´ë–¤ ê¸°ë¶„ì¸ê°€ìš”?\nâ¤ ê·¸ë“¤ì˜ ë¬´ì§€ì— ë¶„ë…¸í•˜ë©°, ë” í° ì†Œë¦¬ë¡œ ì§ˆë¬¸ì„ ë˜ì§€ê³  ì‹¶ë‹¤.\nâ¤ ë‚˜ ë˜í•œ ì…ì„ ë‹¤ë¬¼ê³  ì €ë“¤ ì‚¬ì´ì— ì„ì—¬ ìˆ¨ê³  ì‹¶ë‹¤.\n\n*(í”Œë ˆì´ì–´ ë‹µë³€ í™•ì¸)*",
                "???: í™˜ì˜í•´, ì§ˆë¬¸ì„ ë˜ì¡Œìœ¼ë‚˜ ë©”ì•„ë¦¬ì¡°ì°¨ ëŒì•„ì˜¤ì§€ ì•ŠëŠ” ê³ ë…ì˜ ë°©ì— ë“¤ì–´ì˜¨ ê±¸. ì´ì œ ë„Œ ì•Œê²Œ ë  ê±°ì•¼. ì´ ë„ì‹œì˜ ì¹¨ë¬µì´ ê·¸ì € ë¬´ê´€ì‹¬ì´ ì•„ë‹ˆë¼, ê±°ëŒ€í•œ ë¬´ì–¸ê°€ì— ëŒ€í•œ ì§‘ë‹¨ì ì¸ ê³µí¬ë¼ëŠ” ì‚¬ì‹¤ì„ ë§ì´ì§€.",
                "ë©€ì–´ì§€ëŠ” í–‰ì¸ë“¤ì˜ ë’·ëª¨ìŠµì´ ë§ˆì¹˜ ê¹ì•„ ë†“ì€ ì¸í˜•ì²˜ëŸ¼ ì´ì§ˆì ìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤. ì§ˆë¬¸ì€ í™”ì‚´ì´ ë˜ì–´ ë‹¹ì‹ ì—ê²Œë¡œ ëŒì•„ì™”ìŠµë‹ˆë‹¤. ë‹¹ì‹ ì€ ì´ì œ ëˆ„êµ¬ë¥¼ ë¯¿ì–´ì•¼ í• ê¹Œìš”? ë‹¹ì‹ ì˜ ëª©ì†Œë¦¬ì— ëŒ€ë‹µí•˜ì§€ ì•ŠëŠ” êµ°ì¤‘? ì•„ë‹ˆë©´ ë‹¹ì‹ ì—ê²Œë§Œ ë§ì„ ê±¸ì–´ì˜¤ëŠ” ì´ ë‚´ë©´ì˜ í™˜ì²­?",
              ],
            },
          ],
        },
      ];

      function saveState() {
        historyStack.push(
          JSON.parse(
            JSON.stringify({
              stats,
              currentIdx,
              textIdx,
              resTextIdx,
              isShowingResult,
              finalEncStep,
            })
          )
        );
        document.getElementById("back-button").style.display = "block";
      }

      function goBack() {
        if (historyStack.length === 0) return;

        const prevState = historyStack.pop();

        // 1. ë°ì´í„° ë³µêµ¬
        stats = prevState.stats;
        currentIdx = prevState.currentIdx;
        textIdx = prevState.textIdx;
        resTextIdx = prevState.resTextIdx;
        isShowingResult = prevState.isShowingResult;
        finalEncStep = prevState.finalEncStep;

        // 2. UI ì´ˆê¸°í™”
        document.getElementById("back-button").style.display =
          historyStack.length > 0 ? "block" : "none";
        document.getElementById("main-window").style.background = "#121212";
        document.getElementById("header-container").style.display = "block";

        refreshLog();

        // 3. í˜„ì¬ ìƒíƒœì— ë§ëŠ” í™”ë©´ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
        if (currentIdx < scenario.length) {
          if (isShowingResult) {
            renderResultPage();
          } else {
            render();
          }
        } else {
          renderFinalEncounter();
        }
      }

      function refreshLog() {
        const content = document.getElementById("log-content");
        content.innerHTML = "";
        stats.logHistory.forEach((msg) => {
          const div = document.createElement("div");
          div.style.marginBottom = "10px";
          div.innerText = `> ${msg}`;
          content.prepend(div);
        });
      }

      function updateLog(msg) {
        stats.logHistory.push(msg);
        refreshLog();
      }

      function render() {
        const header = document.getElementById("chapter-header");
        const subtitleEl = document.getElementById("chapter-subtitle");
        const display = document.getElementById("text-display");
        const container = document.getElementById("choice-container");
        container.innerHTML = "";
        
        if (currentIdx < scenario.length) {
          const scene = scenario[currentIdx];
          header.innerText = scene.title;
          
          // ğŸŒŸ ê³ ì •ëœ ë¶€ì œë¥¼ í™”ë©´ ìƒë‹¨ì— í‘œì‹œ
          if (scene.subtitle) {
             subtitleEl.innerText = scene.subtitle;
             subtitleEl.style.display = "block";
          } else {
             subtitleEl.style.display = "none";
          }
          
          if (!isShowingResult && textIdx < scene.lines.length) {
            let line = scene.lines[textIdx];
            let isThought = line.includes("*");
            let handled = false;
            let isInputRequired = line.includes("*(í”Œë ˆì´ì–´ ë‹µë³€ í™•ì¸)*");

            const advanceLine = () => {
              textIdx++;
              render();
            };

            if (line.includes("â¤")) {
              const parts = line.split("â¤");
              let mainText = parts[0].replace("*(í”Œë ˆì´ì–´ ë‹µë³€ í™•ì¸)*", "").trim();
              display.innerHTML = (isThought && mainText) ? `<span class="thought-pause">${mainText}</span>` : mainText;

              for (let i = 1; i < parts.length; i++) {
                let choiceText = parts[i].replace("*(í”Œë ˆì´ì–´ ë‹µë³€ í™•ì¸)*", "").trim();
                const btn = document.createElement("button");
                btn.className = "choice-btn";
                btn.innerText = "â¤ " + choiceText;
                btn.onclick = () => {
                  if (window.getSelection().toString()) return;
                  saveState();
                  updateLog(`[ì„ íƒ] ${choiceText}`);
                  advanceLine();
                };
                container.appendChild(btn);
              }
              handled = true;
            } 
            else if (isInputRequired) {
              let mainText = line.replace("*(í”Œë ˆì´ì–´ ë‹µë³€ í™•ì¸)*", "").trim();
              display.innerHTML = (isThought && mainText) ? `<span class="thought-pause">${mainText}</span>` : mainText;

              const inputField = document.createElement("input");
              inputField.type = "text";
              inputField.className = "player-input-field";
              inputField.placeholder = "ì´ê³³ì— ë‹¹ì‹ ì˜ ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”...";
              
              inputField.addEventListener("keypress", function(event) {
                if (event.key === "Enter") {
                  event.preventDefault();
                  btn.click();
                }
              });

              container.appendChild(inputField);

              const btn = document.createElement("button");
              btn.className = "choice-btn next-btn";
              btn.innerText = "ë‹µë³€ ê¸°ë¡ ë° ë‹¤ìŒ [â–¶]";
              btn.onclick = () => {
                if (window.getSelection().toString()) return;
                const answer = inputField.value.trim();
                if (!answer) {
                  alert("ë‹µë³€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                  return;
                }
                saveState();
                updateLog(`[ë‹µë³€] ${answer}`);
                advanceLine();
              };
              container.appendChild(btn);
              setTimeout(() => inputField.focus(), 10);
              handled = true;
            }

            if (!handled) {
              display.innerHTML = isThought ? `<span class="thought-pause">${line}</span>` : line;
              const btn = document.createElement("button");
              btn.className = "choice-btn next-btn";
              btn.innerText = "ë‹¤ìŒ [â–¶]";
              btn.onclick = () => {
                if (window.getSelection().toString()) return;
                saveState();
                advanceLine();
              };
              container.appendChild(btn);
            }
          } else if (!isShowingResult) {
            display.innerText = "ë‹¹ì‹ ì˜ ê²°ë‹¨ì„ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.";
            scene.choices.forEach((c) => {
              const btn = document.createElement("button");
              btn.className = "choice-btn";
              btn.innerText = c.text;
              btn.onclick = () => {
                if (window.getSelection().toString()) return;
                saveState();
                stats.pav += c.pav;
                stats.rec += c.rec;
                stats.rad += c.rad;
                stats.mod += c.mod;
                updateLog(c.log);
                stats.mirrorHistory.push(c.mirrorLog);
                currentResArray = c.res;
                resTextIdx = 0;
                isShowingResult = true;
                renderResultPage();
              };
              container.appendChild(btn);
            });
          }
        } else {
          renderFinalEncounter();
        }
      }

      function renderResultPage() {
        const display = document.getElementById("text-display");
        const container = document.getElementById("choice-container");
        container.innerHTML = "";
        let line = currentResArray[resTextIdx];
        let isThought = line.includes("*");

        const advanceRes = () => {
          if (resTextIdx < currentResArray.length - 1) {
            resTextIdx++;
            renderResultPage();
          } else {
            currentIdx++;
            textIdx = 0;
            resTextIdx = 0;
            finalEncStep = 0;
            isShowingResult = false;
            render();
          }
        };

        let handled = false;
        let isInputRequired = line.includes("*(í”Œë ˆì´ì–´ ë‹µë³€ í™•ì¸)*");

        if (line.includes("â¤")) {
          const parts = line.split("â¤");
          let mainText = parts[0].replace("*(í”Œë ˆì´ì–´ ë‹µë³€ í™•ì¸)*", "").trim();
          display.innerHTML = (isThought && mainText) ? `<span class="thought-pause">${mainText}</span>` : mainText;

          for (let i = 1; i < parts.length; i++) {
            let choiceText = parts[i].replace("*(í”Œë ˆì´ì–´ ë‹µë³€ í™•ì¸)*", "").trim();
            const btn = document.createElement("button");
            btn.className = "choice-btn";
            btn.innerText = "â¤ " + choiceText;
            btn.onclick = () => {
              if (window.getSelection().toString()) return;
              saveState();
              updateLog(`[ì„ íƒ] ${choiceText}`);
              advanceRes();
            };
            container.appendChild(btn);
          }
          handled = true;
        } 
        else if (isInputRequired) {
          let mainText = line.replace("*(í”Œë ˆì´ì–´ ë‹µë³€ í™•ì¸)*", "").trim();
          display.innerHTML = (isThought && mainText) ? `<span class="thought-pause">${mainText}</span>` : mainText;

          const inputField = document.createElement("input");
          inputField.type = "text";
          inputField.className = "player-input-field";
          inputField.placeholder = "ì´ê³³ì— ë‹¹ì‹ ì˜ ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”...";
          
          inputField.addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
              event.preventDefault();
              btn.click();
            }
          });

          container.appendChild(inputField);

          const btn = document.createElement("button");
          btn.className = "choice-btn next-btn";
          btn.innerText = "ë‹µë³€ ê¸°ë¡ ë° ë‹¤ìŒ [â–¶]";
          btn.onclick = () => {
            if (window.getSelection().toString()) return;
            const answer = inputField.value.trim();
            if (!answer) {
              alert("ë‹µë³€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
              return;
            }
            saveState();
            updateLog(`[ë‹µë³€] ${answer}`);
            advanceRes();
          };
          container.appendChild(btn);
          setTimeout(() => inputField.focus(), 10);
          handled = true;
        }

        if (!handled) {
          display.innerHTML = isThought ? `<span class="thought-pause">${line}</span>` : line;
          const btn = document.createElement("button");
          btn.className = "choice-btn next-btn";
          btn.innerText = (resTextIdx < currentResArray.length - 1) ? "ë‹¤ìŒ [â–¶]" : "ì¥ë©´ ì „í™˜ [â–¶]";
          btn.onclick = () => {
            if (window.getSelection().toString()) return;
            saveState();
            advanceRes();
          };
          container.appendChild(btn);
        }
      }

      function renderFinalEncounter() {
        document.getElementById("chapter-header").innerText = "ì œ4 ë§‰: ë¶ˆë¶™ì§€ ì•Šì€ ì¬";
        // ğŸŒŸ ì œ4ë§‰ì˜ ë¶€ì œ ì„¤ì •
        const subtitleEl = document.getElementById("chapter-subtitle");
        subtitleEl.innerText = "â€” ë‹¹ì‹ ì´ ì–´ë””ì— ìˆì–´ì•¼ í•˜ëŠ”ì§€ ì•Œê²Œ ë˜ëŠ” ìˆœê°„, ë„ì‹œëŠ” ë” ì´ìƒ ë‚¯ì„¤ì§€ ì•Šë‹¤. ê·¸ë ‡ë‹¤ê³  ìµìˆ™í•´ì§€ëŠ” ê±´ ì•„ë‹ˆì§€ë§Œ.";
        subtitleEl.style.display = "block";

        const display = document.getElementById("text-display");
        const container = document.getElementById("choice-container");
        container.innerHTML = "";
        const isRec = stats.rec >= stats.pav;
        const isRad = stats.rad >= stats.mod;

        let encounterLines = isRec
          ? [
              "ì˜¤í›„ í•´ëŠ” ì´ë¯¸ ê¸°ìš¸ì—ˆì§€ë§Œ ê±°ë¦¬ëŠ” ì•„ì§ë„ ì†Œë€í•©ë‹ˆë‹¤. ë…¸ë©´ ì „ì°¨ê°€ ì²œì²œíˆ ì§€ë‚˜ê°€ê³ , ê°€ìŠ¤ë“± ìœ„ì— ì•‰ì€ ìƒˆëŠ” ê¼¬ë¦¬ë¥¼ í„¸ì–´ëƒ…ë‹ˆë‹¤. í•˜ì–€ ë¨¼ì§€ê°€ í©ë‚ ë¦¬ê³ , ëª¨í‰ì´ì— ì˜¤ë˜ëœ ì±…ë°©ì²˜ëŸ¼ ë³´ì´ëŠ” ê°€ê²Œê°€ ìˆìŠµë‹ˆë‹¤. ëˆ„êµ°ê°€ ë‹¹ì‹ ì´ ì˜¤ê¸°ë¥¼ ê¸°ë‹¤ë¦¬ê¸°ë¼ë„ í•œ ê²ƒì²˜ëŸ¼ ë¬¸ì„ ì—´ê³  ë‚˜ì˜¤ë„¤ìš”. ëª¨ìì±™ ì•„ë˜ ê·¸ë¦¼ì ì†ì—ì„œë„ ì—¬ì¸ì˜ ëˆˆë™ìëŠ” ì •í™•íˆ ì´ˆì ì„ ë§ì¶¥ë‹ˆë‹¤.",
              "ê·¸ë…€ê°€ ì†ì„ ë»—ì–´ ì‰í¬ë³‘ì„ ë‹¹ì‹ ì—ê²Œ ë‚´ë°‰ë‹ˆë‹¤. ì˜ì•„í•´í•˜ëŠ” ì‚¬ì´ì— ì•„ë¥´ì¹´ë‚˜ì˜ ëª©ì†Œë¦¬ê°€ ë±€ì²˜ëŸ¼ í˜ëŸ¬ë‚˜ì™€ ë‹¹ì‹ ì—ê²Œ ë‹¿ìŠµë‹ˆë‹¤.",
              isRad
                ? "â€œë‹¹ì‹ ì€ ì„¸ìƒì„ ê³ ì¹˜ë ¤ í•˜ëŠ” ê²Œ ì•„ë‹ˆë¼, ì´ë¯¸ ì©ì–´ ë²„ë¦° ê»ì§ˆì„ ë²—ê²¨ ë‚´ë ¤ í•˜ëŠ”êµ°ìš”. ì, ì´ ì‰í¬ë³‘ì„ ë³´ì„¸ìš”. ë‹¹ì‹ ì´ë¼ë©´ ì´ â€˜ê²€ì€ ì˜¤ë‹µâ€™ì„ ì–´ë–»ê²Œ ì²˜ë¦¬í•˜ê² ì–´ìš”?â€"
                : "â€œê¸°ë¡ë˜ì§€ ì•Šì€ ì§„ì‹¤ì´ ì–¼ë§ˆë‚˜ ë¬´ê±°ìš´ì§€ ë‹¹ì‹ ì€ ì•Œì£ . ì´ ì‰í¬ë³‘ ì†ì— ë‹´ê¸´ ê°€ëŠ¥ì„±ë“¤ì„ ë‹¹ì‹ ì€ ê·¸ì € ë°”ë¼ë§Œ ë³¼ ê±´ê°€ìš”, ì•„ë‹ˆë©´ í•´ë°©í•  ê±´ê°€ìš”?â€",
              "ì´ ì‰í¬ëŠ” ì•„ì§ ì•„ë¬´ê²ƒë„ ì ì§€ ì•Šì•˜ì§€ë§Œ, ë™ì‹œì— ëª¨ë“  ê°€ëŠ¥ì„±ì„ í’ˆê³  ìˆìŠµë‹ˆë‹¤. ì, ì´ ì‰í¬ë³‘ì„ ì–´ë–»ê²Œ í• ê¹Œìš”?",
            ]
          : [
              "ì‹œê³„íƒ‘ì˜ ê·¸ë¦¼ìê°€ ê¸¸ê²Œ ëŠ˜ì–´ì§„ ê´‘ì¥ í•œë³µíŒ, ëˆ„êµ°ê°€ ë²„ë¦¬ê³  ê°„ ë“¯í•œ ë‚¡ì€ ë²¤ì¹˜ í•˜ë‚˜ê°€ ë†“ì—¬ ìˆìŠµë‹ˆë‹¤. ê·¸ê³³ì— ê²€ì€ ê³ ì–‘ì´ í•œ ë§ˆë¦¬ê°€ ì•‰ì•„ ë‹¹ì‹ ì„ ì¡°ìš©íˆ ì‘ì‹œí•©ë‹ˆë‹¤. ê·¸ê°€ ì•ë°œì„ í•¥ìœ¼ë©° ê³ ê°œë¥¼ ë“­ë‹ˆë‹¤.",
              "ì´ë‚´ ì‘ì€ ì•ë°œì´ ë²¤ì¹˜ ìœ„ì— ë†“ì¸ ì‰í¬ë³‘ì„ ë‹¹ì‹  ìª½ìœ¼ë¡œ íˆ­ ë°€ì–´ ë²„ë¦¬ê³ ëŠ”, ë¯¿ê¸° í˜ë“¤ê²Œë„ ë‹¹ì‹ ì—ê²Œ ë§ì„ ê±¸ê¸° ì‹œì‘í•©ë‹ˆë‹¤.",
              isRad
                ? "â€œê·¸ ì§€ë…í•œ ê³„ì‚°ë ¥ì´ ë§ˆìŒì— ë“ ë‹¤. ìë„¤ëŠ” í˜¼ëˆì„ í˜ì˜¤í•˜ì§€. ì•„ë‹ˆ, í˜¼ëˆì„ â€˜ì •ë¦¬â€™í•˜ê³  ì‹¶ì–´ í•´. ì´ ì‰í¬ë³‘ì€ í†µì œë˜ì§€ ì•Šì€ ë³€ìˆ˜ì¼ ë¿ì´ë‹¤. ì´ê±¸ ì–´ë–»ê²Œ ê´€ë¦¬í•  í…Œì§€?â€"
                : "â€œìƒì‹ì˜ ëŒì„ ì§€í‚¤ë˜ ìë„¤ì˜ ì¸ë‚´ì‹¬ì„ ë†’ì´ í‰ê°€í•œë‹¤. ì„¸ìƒì´ ì•„ë¬´ë¦¬ ë¹„ëª…ì„ ì§ˆëŸ¬ë„ ìë„¤ëŠ” í‰ì˜¨ì„ íƒí–ˆì§€. ì, ì—¬ê¸° ì•„ì£¼ ìœ„í—˜í•œ ì‰í¬ê°€ ìˆë„ë‹¤. ìë„¤ì˜ í‰í™”ë¥¼ ìœ„í•´ ì´ ë³‘ì„ ì–´ë–»ê²Œ ë‹¤ë£° í…Œì§€?â€",
              "ì´ ì‰í¬ëŠ” ì•„ì§ ì•„ë¬´ê²ƒë„ ì ì§€ ì•Šì•˜ì§€ë§Œ, ë™ì‹œì— ëª¨ë“  ê°€ëŠ¥ì„±ì„ í’ˆê³  ìˆìŠµë‹ˆë‹¤. ì, ì´ ì‰í¬ë³‘ì„ ì–´ë–»ê²Œ í• ê¹Œìš”?",
            ];

        function showEnc() {
          let line = encounterLines[finalEncStep];
          display.innerHTML = line.includes("*") ? `<span class="thought-pause">${line}</span>` : line;
          
          container.innerHTML = "";
          if (finalEncStep < encounterLines.length - 1) {
            const btn = document.createElement("button");
            btn.className = "choice-btn next-btn";
            btn.innerText = "ë‹¤ìŒ [â–¶]";
            btn.onclick = () => {
              saveState();
              finalEncStep++;
              showEnc();
            };
            container.appendChild(btn);
          } else {
            [
              {
                t: "â¤ ë³‘ì„ ì—´ì–´ ë²¤ì¹˜ ì•„ë˜ í™ë°”ë‹¥ì— ìŸì•„ ë²„ë¦°ë‹¤.",
                res: isRec
                  ? [
                      "ê²€ì€ ì•¡ì²´ëŠ” ì°¨ê°€ìš´ í™ ì†ìœ¼ë¡œ ë§¥ì—†ì´ ì¦ì•„ë“¤ì–´, ì´ë‚´ í”ì ì¡°ì°¨ ë‚¨ê¸°ì§€ ì•Šê³  ì‚¬ë¼ì§‘ë‹ˆë‹¤. ì“°ì´ì§€ ëª»í•œ ì´ì•¼ê¸°ëŠ” ëˆ„êµ¬ë„ ë‹¤ì¹˜ê²Œ í•  ìˆ˜ ì—†ê³ , ë°”ë‹¥ì€ ë‹¤ì‹œ ì•„ë¬´ ì¼ë„ ì—†ì—ˆë‹¤ëŠ” ë“¯ í‰ì˜¨í•œ ìƒ‰ì„ ë˜ì°¾ì•˜ìŠµë‹ˆë‹¤. ë‹¹ì‹ ì€ ë°©ê¸ˆ, íƒœì–´ë‚˜ì§€ ëª»í•œ ìˆ˜ë§ì€ ì§„ì‹¤ì—ê²Œ ê°€ì¥ ê³ ìš”í•œ ë¬´ë¤ì„ ë‚´ì–´ ì¤€ ì…ˆì…ë‹ˆë‹¤.",
                      "???: ë´. ì‰í¬ê°€ ììœ ë¥¼ ì°¾ì•˜ì–´. ì“°ì´ì§€ ëª»í•œ ë¬¸ì¥ì€ ëˆ„êµ¬ë„ ì†ì¼ ìˆ˜ ì—†ê³ , ìŸì•„ì§„ ì‰í¬ëŠ” ê·¸ì € í™ìœ¼ë¡œ ëŒì•„ê°ˆ ë¿ì´ì•¼. ë„Œ ì§€ê¸ˆ ì´ ë„ì‹œì˜ ë³µì¡í•œ ì†ŒìŒ í•˜ë‚˜ë¥¼ ì˜ì›íˆ ì ì¬ìš´ ê±°ì•¼. ì´ì œ ë„¤ ì•ì˜ ê¸¸ì€ ë‹¤ì‹œ ì•„ë¬´ê²ƒë„ ì íˆì§€ ì•Šì€ ë°±ì§€ì²˜ëŸ¼ ê³ ìš”í•´ì¡Œì–´. ì ì–´ë„ ëˆ„êµ°ê°€ëŠ” ë„¤ê°€ ê·¸ í˜¼ëˆì„ ëŠì–´ ëƒ„ìœ¼ë¡œì¨ ì´ ë°¤ì„ ë¬´ì‚¬íˆ ë„˜ê²¼ë‹¤ëŠ” ê±¸ ê¸°ì–µí•˜ê² ì§€.",
                    ]
                  : [
                      "???: ì •ê°ˆí•œ ëë§ºìŒì´ì•¼. í•˜ì§€ë§Œ í†µì œë˜ì§€ ì•ŠëŠ” ê²ƒì€ ë•Œë¡œ ë” í° ê·¸ë¦¬ì›€ì´ ë˜ê¸°ë„ í•˜ì§€. ì§€ê¸ˆì€ ì‰í¬ë¥¼ ìŸì•„ ë°”ë‹¥ì„ ê¹¨ë—ì´ ë¹„ì› ì§€ë§Œ, ê·¸ ìë¦¬ì— ë‚¨ì€ ì–¼ë£©ì€ ì´ì œ ë„ˆì˜ ê¸°ë¡ë¶€ ì–´ë””ì—ë„ ë‚¨ì§€ ì•ŠëŠ” ìœ ë ¹ì´ ë˜ì—ˆì–´. ì ì‹œì•¼ í‰ì˜¨í•´ì§€ê² ì§€ë§Œ, ê°€ë” ë¹„ê°€ ë‚´ë¦¬ëŠ” ë°¤ì´ë©´ í™ ì†ìœ¼ë¡œ ìŠ¤ë©°ë“  ê·¸ ê°€ëŠ¥ì„±ë“¤ì´ ë„ˆì˜ ê¿ˆê²°ì„ ê²€ê²Œ ì ì‹¤ì§€ë„ ëª¨ë¥´ì§€. ë¹„ì›Œ ë‚¸ ìë¦¬ì— ì§ˆì„œê°€ ê¹ƒë“¤ê¸¸ ë°”ë¼ê² ì–´.",
                      "ë‹¹ì‹ ì€ ê´€ë¦¬ ëŒ€ì‹  ì¹¨ë¬µì„ íƒí–ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ê¸°ë¡ë˜ì§€ ì•Šì€ ê²ƒì€ ê²°ì½” ìŠíˆì§€ ì•Šê³ , ì˜¤ì§ ë‹¹ì‹ ì˜ ì§ê° ì†ì—ì„œë§Œ ì˜ˆë¯¼í•˜ê²Œ ì‚´ì•„ ì›€ì§ì¼ ê²ƒì…ë‹ˆë‹¤. ë‹¹ì‹ ì€ ê¹¨ë—í•œ ë°”ë‹¥ì„ ì–»ì—ˆìœ¼ë‚˜, ëŒ€ì‹  ê·¸ í™ ë°‘ì— ë¬´ì—‡ì´ ë¬»í˜€ ìˆëŠ”ì§€ ì•„ëŠ” ìœ ì¼í•œ ëª©ê²©ìê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.",
                    ],
              },
              {
                t: "â¤ ë³‘ì„ ê½‰ ì ê·¼ ì±„ ì½”íŠ¸ ê°€ì¥ ê¹Šì€ ì£¼ë¨¸ë‹ˆì— ë„£ëŠ”ë‹¤.",
                res: isRec
                  ? [
                      "???: ê²°êµ­ í’ˆê¸°ë¡œ í–ˆêµ°. ìŸì•„ ë²„ë ¤ í•´ë°©í•˜ê¸°ë³´ë‹¤ëŠ”, ìŠ¤ìŠ¤ë¡œ ê·¸ ë¬´ê²Œë¥¼ ê²¬ë””ëŠ” ê¸¸ì„ íƒí–ˆì–´. í•˜ì§€ë§Œ ê¸°ì–µí•´. ê·¸ ë³‘ì´ ì£¼ë¨¸ë‹ˆ ì†ì—ì„œ í”ë“¤ë¦´ ë•Œë§ˆë‹¤, ë„¤ê°€ ì‚¼í‚¨ ê·¸ ì§„ì‹¤ì´ ë„¤ í˜ˆê´€ì„ íƒ€ê³  ì¡°ìš©íˆ í¼ì ¸ ë‚˜ê°ˆ ê±°ì•¼. ë„Œ ì´ì œ ì•ˆì „í•œ ê´€ì°°ìê°€ ì•„ë‹ˆë¼, ì´ ë¹„ë°€ê³¼ í•¨ê»˜ ì²œì²œíˆ ë¬¼ë“¤ì–´ ê°€ëŠ” ë‹¹ì‚¬ìê°€ ëœ ì…ˆì´ì§€. ì™¸íˆ¬ê°€ ë¬µì§í•´ì§ˆ ë•Œë§ˆë‹¤, ë„¤ê°€ ì™¸ë©´í•œ ì € ì•ˆê°œì˜ ìˆ¨ì†Œë¦¬ê°€ ë„¤ ì•ˆì—ì„œ ì¶œë ì¼ ê±°ë‹¤.",
                      "ë‹¹ì‹ ì€ íŒŒê´´ë¥¼ ìœ ì˜ˆí–ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ê°€ìŠ´ ì†ì˜ ë¶ˆê½ƒì€ êº¼ì§€ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê·¸ ë¶ˆê½ƒì€ ë‹¹ì‹ ì˜ í’ˆ ì•ˆì—ì„œ ì€ë°€í•˜ê²Œ íƒ€ì˜¤ë¥´ëŠ” ë²•ì„ ë°°ìš¸ ê²ƒ ì…ë‹ˆë‹¤.",
                    ]
                  : [
                      "???: íš¨ìœ¨ì ì¸ ê´€ë¦¬ì•¼. ìŸì•„ì§„ ì‰í¬ëŠ” ì˜¤ì—¼ì´ì§€ë§Œ, ë³‘ì— ë‹´ê¸´ ì‰í¬ëŠ” ìì‚°ì´ì§€. ë„Œ ì´ í˜¼ëˆì˜ ê°€ëŠ¥ì„±ì„ ë„¤ ëª¸ ì•ˆìœ¼ë¡œ ê²©ë¦¬í–ˆì–´. ì´ì œ ì´ ë„ì‹œì˜ í‰í™”ëŠ” ë„¤ ì£¼ë¨¸ë‹ˆ ì†ì— ë‹´ê¸´ ì € ì‘ì€ ë³‘ì˜ ë°€íë ¥ì— ë‹¬ë ¤ ìˆì§€. ë„Œ ìŠ¤ìŠ¤ë¡œë¥¼ ì´ ë„ì‹œì—ì„œ ê°€ì¥ ìœ„íƒœë¡œìš´ ë³´ê´€í•¨ìœ¼ë¡œ ë§Œë“  ê±°ì•¼.",
                      "ë‹¹ì‹ ì€ ì´ ë¬´ê±°ìš´ ì‰í¬ë¥¼ í‰ìƒ ì§Šì–´ì§€ê³  ê±¸ì–´ì•¼ í•©ë‹ˆë‹¤. ë³‘ ì•ˆì—ì„œ ì‰í¬ê°€ í”ë“¤ë¦¬ëŠ” ì†Œë¦¬ëŠ” ì–´ëŠë§ ë‹¹ì‹ ì˜ ì‹¬ì¥ë°•ë™ê³¼ ê¸°ë¬˜í•œ ë°•ìë¥¼ ë§ì¶”ê¸° ì‹œì‘í•©ë‹ˆë‹¤. ì‰í¬ë³‘ í•˜ë‚˜ë§Œí¼ì˜ ë¬´ê²ŒëŠ” ì´ì œ ë‹¹ì‹ ì˜ ë³´í­ì´ì, ë‹¹ì‹ ì´ ê°ë‹¹í•´ì•¼ í•  ìœ ì¼í•œ ë¹„ë°€ì…ë‹ˆë‹¤. ë‹¹ì‹ ì€ ì´ì œ ì‰í¬ê°€ ì ì§€ ëª»í•œ ìˆ˜ë§Œ ê°€ì§€ì˜ ê°€ëŠ¥ì„±ì„ í’ˆì€ ì±„, ì•„ë¬´ë„ ì½ì§€ ëª»í•˜ëŠ” ë‹¹ì‹ ë§Œì˜ ë¬¸ì¥ì„ ê°€ìŠ´ ì†ì— í’ˆê³  ê±·ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.",
                    ],
              },
            ].forEach((c) => {
              const btn = document.createElement("button");
              btn.className = "choice-btn";
              btn.innerText = c.t;
              btn.onclick = () => {
                saveState();
                updateLog(`[ì„ íƒ] ${c.t.replace("â¤ ", "").trim()}`);
                currentResArray = c.res;
                resTextIdx = 0;
                isShowingResult = true;
                renderFinalResultPage();
              };
              container.appendChild(btn);
            });
          }
        }
        showEnc();
      }

      function renderFinalResultPage() {
        const display = document.getElementById("text-display");
        const container = document.getElementById("choice-container");
        container.innerHTML = "";
        display.innerText = currentResArray[resTextIdx];
        const btn = document.createElement("button");
        btn.className = "choice-btn next-btn";
        if (resTextIdx < currentResArray.length - 1) {
          btn.innerText = "ë‹¤ìŒ [â–¶]";
          btn.onclick = () => {
            saveState();
            resTextIdx++;
            renderFinalResultPage();
          };
        } else {
          btn.innerText = "ì¢…ë§‰ìœ¼ë¡œ [â–¶]";
          btn.onclick = () => {
            saveState();
            showFinalMirror();
          };
        }
        container.appendChild(btn);
      }

      function showFinalMirror() {
        document.getElementById("chapter-header").innerText = "ì¢…ë§‰: ë„ì‹œì˜ ê²½ì²©ì€ ì²œì²œíˆ ë‹«íŒë‹¤";
        // ì¢…ë§‰ì—ì„œëŠ” ë¶€ì œë¥¼ ìˆ¨ê¹ë‹ˆë‹¤.
        document.getElementById("chapter-subtitle").style.display = "none";
        
        const display = document.getElementById("text-display");
        const container = document.getElementById("choice-container");
        const isRec = stats.rec >= stats.pav;
        const isRad = stats.rad >= stats.mod;
        let identity = isRec
          ? isRad
            ? "íŒŒê´´ë¥¼ í†µí•œ ì •í™”ì˜ ì§‘í–‰ê´€"
            : "ì¹¨ë¬µí•˜ëŠ” ì§„ì‹¤ì˜ ì¦ì–¸ì"
          : isRad
          ? "í˜¼ëˆì„ í•´ì²´í•˜ëŠ” ì² í˜ˆì˜ ê´€ë¦¬ì"
          : "ìƒì‹ì˜ ëŒì„ ìˆ˜í˜¸í•˜ëŠ” íŒŒìˆ˜ê¾¼";

        const orderedHistory = stats.mirrorHistory.slice().reverse();

        const mLines = [
          "\n\n í•˜ì§€ë§Œ ë‹¹ì‹ ì´ ì •ì‘ ì‰í¬ë³‘ì— ì†ì„ ë»—ëŠ” ìˆœê°„, ì£¼ë³€ì˜ ì†ŒìŒì´ ë©€ì–´ì§€ê³  ì„¸ìƒì€ í‘ë°±ìœ¼ë¡œ ì ë©¸í•©ë‹ˆë‹¤. ë‹¹ì‹ ì˜ ë¨¸ë¦¿ì†ì—ì„œ ê°€ì¥ ì‹œë„ëŸ¬ì› ë˜ ëª©ì†Œë¦¬ë“¤ì´ ì¼ì œíˆ ì…ì„ ë‹¤ë¬¼ê³ , ë‹¨ í•˜ë‚˜ì˜ ëª©ì†Œë¦¬ë§Œì´ ë‹¹ì‹ ì˜ ì‹¬ì¥ë°•ë™ì„ íƒ€ê³  íë¦…ë‹ˆë‹¤.",
          `???: ì ê¹. ì •ë§ë¡œ ì´ê²Œ ë„¤ê°€ ì›í–ˆë˜ ê²°ë§ì¸ê°€? ${identity}(ìœ¼)ë¡œ ì‚¬ëŠ” ê²ƒ.`,
          `ëˆˆì•ì˜ ì‰í¬ë³‘ì´ ê±°ìš¸ì²˜ëŸ¼ ë§¤ë„ëŸ¬ì›Œì§€ë©°, ì´ìœ½ê³  ë‹¹ì‹ ì˜ ë‚´ë©´ì„ ë¹„ì¶¥ë‹ˆë‹¤. ${stats.mirrorHistory.join(
            ", "
          )}ê¹Œì§€â€¦. ëª¨ë“  íŒŒí¸ì´ ë‹¹ì‹ ì˜ ëˆˆë™ì ì•ˆì— ì¼ë ì…ë‹ˆë‹¤.`,
        ];

        let mStep = 0;
        function stepM() {
          display.innerText = mLines[mStep];
          container.innerHTML = "";
          if (mStep < mLines.length - 1) {
            const btn = document.createElement("button");
            btn.className = "choice-btn next-btn";
            btn.innerText = "ë‹¤ìŒ [â–¶]";
            btn.onclick = () => {
              saveState();
              mStep++;
              stepM();
            };
            container.appendChild(btn);
          } else {
            [
              "â¤ ë‚˜ëŠ” ê·¸ì € ë‚´ê°€ ë³¸ ê²ƒì„ ë¯¿ì„ ë¿ì´ë‹¤. (í”ë“¤ë¦¼ ì—†ëŠ” í™•ì‹ . ë‹¹ì‹ ì€ ê±°ìš¸ ì†ì˜ ìì‹ ê³¼ ëˆˆì„ ë§ì¶˜ë‹¤.)",
              "â¤ ë‚˜ëŠ” ë¬´ì—‡ì´ ì˜³ì€ì§€ ì—¬ì „íˆ ëª¨ë¥¸ë‹¤. ê·¸ì € ë°œì„ ë‚´ë””ë”œ ë¿. (ì§€ë…í•œ í”¼ë¡œê°. ë‹¹ì‹ ì€ ê±°ìš¸ ì†ì˜ ìì‹ ìœ¼ë¡œë¶€í„° ê³ ê°œë¥¼ ëŒë¦°ë‹¤.)",
            ].forEach((t) => {
              const btn = document.createElement("button");
              btn.className = "choice-btn";
              btn.innerText = t;
              btn.onclick = () => {
                saveState();
                updateLog(`[ì„ íƒ] ${t.replace("â¤ ", "").trim()}`);
                showEpilogue();
              };
              container.appendChild(btn);
            });
          }
        }
        stepM();
      }

      function showEpilogue() {
        document.getElementById("header-container").style.display = "none";
        const display = document.getElementById("text-display");
        const container = document.getElementById("choice-container");
        container.innerHTML = "";
        document.getElementById("main-window").style.background = "#000";

        let sideText = "";
        if (stats.rec > stats.pav) {
          sideText =
            "ì•ˆê°œ ì†ìœ¼ë¡œ ì‚¬ë¼ì§€ëŠ” ê·¸ë…€ë¥¼ ë³´ëŠ” ë‹¹ì‹ ì˜ ë“± ë’¤ë¡œ, ë¦¬ì˜¹ ì—­ì˜ ê±°ëŒ€í•œ ì‹œê³„ ì†Œë¦¬ê°€ ë“¤ë ¤ì˜µë‹ˆë‹¤.";
        } else if (stats.pav > stats.rec) {
          sideText =
            "ê³ ì–‘ì´ê°€ ì‚¬ë¿íˆ ë– ë‚œ í›„ ë‹¹ì‹ ì€ ë‹¤ì‹œ í™€ë¡œ ë‚¨ê²¨ì§„ ê´‘ì¥ì—ì„œ ìì‹ ì˜ ì½”íŠ¸ ì£¼ë¨¸ë‹ˆë¥¼ ì›€ì¼œì¥¡ë‹ˆë‹¤.";
        } else {
          sideText =
            "ë‹¹ì‹ ì€ ëˆ„êµ¬ì˜ í¸ë„ ì•„ë‹Œ ì±„ í…… ë¹ˆ ê´‘ì¥ì— í™€ë¡œ ì„œ ìˆìŠµë‹ˆë‹¤.";
        }

        const eText = `ê·¸ê²Œ ë‹¹ì‹ ì˜ ì„ íƒì´ë¼ë©´.\n\nì´ ì§§ì€ ë‚´ë©´ì˜ ëŒ€í™”ê°€ ëë‚œ ë’¤, ë‹¤ì‹œ ë¦¬ì˜¹ ì—­ì˜ ì‹œê³„ ì†Œë¦¬ê°€ ë“¤ë¦¬ê³  ì•ˆê°œê°€ ë‹¹ì‹ ì„ ë®ì¹©ë‹ˆë‹¤.\n\n${sideText} ë©ˆì¶° ìˆë˜ ì‹œê³„íƒ‘ì´ ìœ¡ì¤‘í•œ ì†Œë¦¬ë¥¼ ë‚´ë©° 11 ì‹œ 19 ë¶„ìœ¼ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤. ê·¸ë¦¬ê³ , ê°€ë¡œë“±ì´ í•œ ë²ˆ ê¹œë¹¡ì´ë‹¤ê°€ ì™„ì „íˆ êº¼ì§‘ë‹ˆë‹¤. ë‹¹ì‹ ì˜ ë¨¸ë¦¿ì† ê°€ì¥ ê¹Šì€ ë°© ì•ˆì—ì„œ ì‰í¬ ëƒ„ìƒˆ ì„ì¸ ì¬ê°€ ê³ ìš”íˆ ê°€ë¼ì•‰ê³  ìˆìŠµë‹ˆë‹¤.\n\në§ˆì¹¨ë‚´, â€˜ë‹¹ì‹ â€™ì´ë¼ëŠ” ê³ ë…í•œ ì´ë¬¼ì§ˆì„ ê¸°êº¼ì´ ì‚¼ì¼œ ë²„ë¦° ì´ ê±°ëŒ€í•œ ë„ì‹œì˜ ê²½ì²©ì€, ìš´ëª…ì„ ê´€ì¥í•˜ëŠ” ì‹ ì´ ë‚´ë¦¬ëŠ” íŒê²°ë¬¸ì²˜ëŸ¼ ì²œì²œíˆ, ê·¸ë¦¬ê³  ì—„ìˆ™í•˜ê²Œ ë‹«í™ë‹ˆë‹¤.\n\nê·¸ë¦¬í•˜ì—¬ ì•„ë¬´ë„ ë‹¹ì‹ ì„ ë¬»ì§€ ì•ŠëŠ” ì´ ë„ì‹œ, 1890 ë…„ì˜ íŒŒë¦¬ê°€ ë‹¹ì‹ ì„ ëª¨ë¥¸ ì±„ë¡œ ë‚¨ì•„ ìˆë”ë¼ë„, ë‹¹ì‹ ì€ ì œìë¦¬ì— ì„­ë‹ˆë‹¤.`;

        display.innerText = eText;

        const resBtn = document.createElement("button");
        resBtn.className = "choice-btn next-btn";
        resBtn.innerText = "ìµœì¢… ì„±í–¥ ì§„ë‹¨ì„œ [â–¶]";
        resBtn.onclick = renderFinalReport;
        container.appendChild(resBtn);
      }

      function renderFinalReport() {
        const display = document.getElementById("text-display");
        const container = document.getElementById("choice-container");
        container.innerHTML = "";

        let f, t, identity;

        if (stats.rec > stats.pav) f = "ì¬ê±´ì˜ ì†";
        else if (stats.pav > stats.rec) f = "ì„± íŒŒë¸”ë¡œí”„ ì¬ë‹¨";
        else f = "íŒë‹¨ ë³´ë¥˜(ì¤‘ë¦½)";

        if (stats.rad > stats.mod) t = "ê¸‰ì§„ì ";
        else if (stats.mod > stats.rad) t = "ì˜¨ê±´ì ";
        else t = "íŒë‹¨ ë³´ë¥˜(ê· í˜•)";

        if (f === "ì¬ê±´ì˜ ì†") {
          if (t === "ê¸‰ì§„ì ") identity = "íŒŒê´´ë¥¼ í†µí•œ ì •í™”ì˜ ì§‘í–‰ê´€";
          else if (t === "ì˜¨ê±´ì ") identity = "ì¹¨ë¬µí•˜ëŠ” ì§„ì‹¤ì˜ ì¦ì–¸ì";
          else identity = "ê¸°ë¡ê³¼ ê¸°ì–µ ì‚¬ì´ì˜ ì¬ê±´ì";
        } else if (f === "ì„± íŒŒë¸”ë¡œí”„ ì¬ë‹¨") {
          if (t === "ê¸‰ì§„ì ") identity = "í˜¼ëˆì„ í•´ì²´í•˜ëŠ” ì² í˜ˆì˜ ê´€ë¦¬ì";
          else if (t === "ì˜¨ê±´ì ") identity = "ìƒì‹ì˜ ëŒì„ ìˆ˜í˜¸í•˜ëŠ” íŒŒìˆ˜ê¾¼";
          else identity = "ì§ˆì„œë¥¼ ê³ ìˆ˜í•˜ëŠ” ì¬ë‹¨ì˜ ì¤‘ì¬ì";
        } else {
          if (t === "ê¸‰ì§„ì ") identity = "ê²½ê³„ë¥¼ í—ˆë¬´ëŠ” ììœ ì˜ ì„ ë™ê°€";
          else if (t === "ì˜¨ê±´ì ") identity = "ì•ˆê°œë¥¼ í—¤ë§¤ëŠ” ê³ ë…í•œ ì² í•™ì";
          else identity = "ì‹¬ì—°ì„ ì‘ì‹œí•˜ëŠ” ê°ê´€ì  ê´€ì°°ì";
        }

        const maxMargin = 7;
        const currentMargin = Math.abs(stats.rec - stats.pav);
        const convertibility = Math.floor(
          (1 - currentMargin / maxMargin) * 100
        );

        let convComment = "";
        if (convertibility >= 85) convComment = "ìœ ì—°í•œ ê²½ê³„ì¸";
        else if (convertibility >= 50) convComment = "í•©ë¦¬ì  íšŒì˜ì£¼ì˜ì";
        else if (convertibility >= 20) convComment = "í™•ì‹ ì— ì°¬ í–‰ë™ê°€";
        else convComment = "íƒ€í˜‘ ì—†ëŠ” ê·¼ë³¸ì£¼ì˜ì";
display.innerHTML = `
    <div id="final-report-area" class="fade-in" style="
        border: 2px solid #ffffff;
        padding: 15px; 
        background-color: #000000;
        color: #ffffff;
        font-family: 'Nanum Myeongjo', serif; 
        max-width: 480px; 
        margin: 0 auto; 
        box-sizing: border-box;
    ">
        <div style="
            color: #ffffff;
            font-size: 1.2em; 
            font-weight: bold; 
            margin: 0; 
            padding-bottom: 10px; 
            text-align: center; 
            border-bottom: 1px solid #555; 
            letter-spacing: 0;
        ">
            [ ë ˆì¹˜íƒ€í‹°ë³´ì˜ ìˆœê°„: ìµœì¢… ì„±í–¥ ì§„ë‹¨ì„œ ]
        </div>
        <div style="
            margin: 15px 0; 
            background-color: #111111; 
            padding: 15px; 
            border-left: 5px solid #a5d6a7; 
            text-align: center;
        ">
            <div style="font-weight: bold; color: #a5d6a7; font-size: 1.15em;">"${identity}"</div>
        </div>
        <div style="margin-bottom: 20px; font-size: 1em; line-height: 1.8; color: #ffffff;">
            <span style="color: #cccccc; font-weight: bold;">ì†Œì†:</span> <span style="color: #ffffff;">${f}</span><br>
            <span style="color: #cccccc; font-weight: bold;">ì„±í–¥:</span> <span style="color: #ffffff;">${t}</span><br>
            <span style="color: #cccccc; font-weight: bold;">ì „í–¥ ê°€ëŠ¥ì„±:</span> 
            <span style="color: #a5d6a7;">${convertibility}%</span> 
            <span style="font-size: 0.85em; color: #aaaaaa;">(${convComment})</span>
        </div>
        <div style="border-top: 1px solid #444; padding-top: 15px;">
            <div style="font-weight: bold; margin-bottom: 10px; font-size: 0.9em; color: #cccccc;">ë‚´ì¬í™”ëœ ìƒê°ì˜ íŒŒí¸ë“¤:</div>
            <div style="color: #ffffff; font-size: 0.85em; font-style: italic; line-height: 1.7; word-break: keep-all;">${stats.logHistory.join(
              " / "
            )}</div>
        </div>
    </div>`;

        container.innerHTML = `
            <button class="choice-btn next-btn" style="margin-top: 20px; background: #a5d6a7; color: #000; padding: 15px; font-size: 0.95em;" onclick="saveAsImage()">ê²°ê³¼ ì´ë¯¸ì§€ ì €ì¥ [â†“]</button>
            <button class="choice-btn next-btn" style="margin-top: 10px; padding: 10px; font-size: 0.85em;" onclick="location.reload()">ìƒˆë¡œìš´ ì—¬ì • ì‹œì‘</button>
        `;
      }

      function saveAsImage() {
        const reportArea = document.querySelector("#final-report-area");
        if (!reportArea) return;

        document.fonts.ready.then(() => {
          html2canvas(reportArea, {
            backgroundColor: "#000000", // ğŸŒŸ ìº¡ì²˜ ë°°ê²½ìƒ‰ì„ ì™„ì „ ê²€ì •ìœ¼ë¡œ ê³ ì •
            scale: 4,
            useCORS: true,
            logging: false,
            width: reportArea.offsetWidth,
            height: reportArea.offsetHeight,
            onclone: (clonedDoc) => {
              const clonedArea = clonedDoc.getElementById("final-report-area");
              clonedArea.style.opacity = "1";
              // ìº¡ì²˜ ì‹œ ê°•ì œë¡œ ëª¨ë“  í…ìŠ¤íŠ¸ë¥¼ í°ìƒ‰ìœ¼ë¡œ ë³€ê²½
              clonedArea.style.color = "#ffffff";
              const allTexts = clonedArea.querySelectorAll("*");
              allTexts.forEach(el => {
                  if (window.getComputedStyle(el).color !== 'rgb(165, 214, 167)') { // í¬ì¸íŠ¸ ì»¬ëŸ¬(ì—°ë‘) ì œì™¸í•˜ê³  í°ìƒ‰ ì ìš©
                      el.style.color = "#ffffff";
                  }
              });
            },
          }).then((canvas) => {
            try {
              const link = document.createElement("a");
              link.download = `1890_Paris_Archive_${new Date().getTime()}.png`;
              link.href = canvas.toDataURL("image/png");
              link.click();
            } catch (e) {
              console.error("ì´ë¯¸ì§€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", e);
              alert("ì´ë¯¸ì§€ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìŠ¤í¬ë¦°ìƒ·ì„ ì´ìš©í•´ ì£¼ì„¸ìš”.");
            }
          });
        });
      }

      render();
    </script>
  </body>
</html>
